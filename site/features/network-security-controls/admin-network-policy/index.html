
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://www.ovn.org/ovn-kubernetes/features/network-security-controls/admin-network-policy/">
      
      
        <link rel="prev" href="../../user-defined-networks/user-defined-networks/">
      
      
        <link rel="next" href="../network-policy/">
      
      
        
      
      
      <link rel="icon" href="../../../images/ovn-inside-k8s.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>AdminNetworkPolicy - OVN-Kubernetes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#adminnetworkpolicy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="OVN-Kubernetes" class="md-header__button md-logo" aria-label="OVN-Kubernetes" data-md-component="logo">
      
  <img src="../../../images/ovn-inside-k8s.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OVN-Kubernetes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AdminNetworkPolicy
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Blueprint"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Blueprint" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.5 3A5.5 5.5 0 0 1 14 8.5c0 1.33-.47 2.55-1.26 3.5H21v9h-9v-8.26c-.95.79-2.17 1.26-3.5 1.26A5.5 5.5 0 0 1 3 8.5 5.5 5.5 0 0 1 8.5 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent="purple"  aria-label="Nerve Center"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Nerve Center" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19.07 4.93-1.41 1.41A8.01 8.01 0 0 1 20 12a8 8 0 0 1-8 8 8 8 0 0 1-8-8c0-4.08 3.05-7.44 7-7.93v2.02C8.16 6.57 6 9.03 6 12a6 6 0 0 0 6 6 6 6 0 0 0 6-6c0-1.66-.67-3.16-1.76-4.24l-1.41 1.41C15.55 9.9 16 10.9 16 12a4 4 0 0 1-4 4 4 4 0 0 1-4-4c0-1.86 1.28-3.41 3-3.86v2.14c-.6.35-1 .98-1 1.72a2 2 0 0 0 2 2 2 2 0 0 0 2-2c0-.74-.4-1.38-1-1.72V2h-1A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-2.76-1.12-5.26-2.93-7.07"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ovn-org/ovn-kubernetes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ovn-org/ovn-kubernetes
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
    
  
  Overview

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../installation/launching-ovn-kubernetes-on-kind/" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../governance/CONTRIBUTING/" class="md-tabs__link">
          
  
  
    
  
  Developer Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../api-reference/introduction/" class="md-tabs__link">
          
  
  
    
  
  API Reference Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../user-defined-networks/user-defined-networks/" class="md-tabs__link">
          
  
  
    
  
  Features

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../troubleshooting/debugging/" class="md-tabs__link">
          
  
  
    
  
  Troubleshooting

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../observability/metrics/" class="md-tabs__link">
          
  
  
    
  
  Observability

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../okeps/okep-5085-localnet-api/" class="md-tabs__link">
          
  
  
    
  
  Enhancement Proposals

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OVN-Kubernetes" class="md-nav__button md-logo" aria-label="OVN-Kubernetes" data-md-component="logo">
      
  <img src="../../../images/ovn-inside-k8s.png" alt="logo">

    </a>
    OVN-Kubernetes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ovn-org/ovn-kubernetes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ovn-org/ovn-kubernetes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/topology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Topology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/gateway-modes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gateway Modes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/traffic-flows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Traffic Flows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/pod-creation-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pod Creation Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/service-creation-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Service Creation Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/service-traffic-policy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Service Traffic Policy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/host-to-node-port-hairpin-trafficflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Host To NodePort Hairpin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/external-ip-and-loadbalancer-ingress/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ExternalIPs/LoadBalancerIngress
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/ovn-kubernetes-subnets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Internal Subnets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../live-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubevirt VM Live Migration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installation/launching-ovn-kubernetes-on-kind/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Launching OVN-Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installation/launching-ovn-kubernetes-with-helm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Launching OVN-Kubernetes Using Helm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/cli-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/example-pod-creation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deploying Workloads on OVN-Kubernetes cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/example-service-creation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deploying Services on OVN-Kubernetes cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/building-ovn-kubernetes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup and Building
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Developer Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Developer Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../governance/CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../governance/REVIEWING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reviewing Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/developer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coding Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/image-build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OVN-Kubernetes Container Images
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/local_testing_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local Testing Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ci/ci/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CI Testing Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Release Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api-reference/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api-reference/egress-ip-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressIP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api-reference/egress-service-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressService
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api-reference/egress-qos-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressQoS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api-reference/egress-firewall-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressFirewall
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api-reference/admin-epbr-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AdminPolicyBasedExternalRoutes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api-reference/userdefinednetwork-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UserDefinedNetwork
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api-reference/routeadvertisements-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RouteAdvertisements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Universal Connectivity
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Universal Connectivity
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-defined-networks/user-defined-networks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UserDefinedNetwork
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" checked>
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    NetworkSecurityControls
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    NetworkSecurityControls
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    AdminNetworkPolicy
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    AdminNetworkPolicy
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Motivation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Motivation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-storiesuse-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        User-Stories/Use-Cases
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-enable-this-feature-on-an-ovn-kubernetes-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to enable this feature on an OVN-Kubernetes cluster?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow-description" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow Description
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-facing-api-changes" class="md-nav__link">
    <span class="md-ellipsis">
      
        User facing API Changes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User facing API Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adminnetworkpolicy-sample-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        AdminNetworkPolicy Sample API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#baselineadminnetworkpolicy-sample-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        BaselineAdminNetworkPolicy Sample API
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ovn-kubernetes-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        OVN-Kubernetes Implementation Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OVN-Kubernetes Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pass-action-delegate-decision-to-networkpolicies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pass Action: Delegate decision to NetworkPolicies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-action-delegate-decision-to-baselineadminnetworkpolicies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pass Action: Delegate decision to BaselineAdminNetworkPolicies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ovn-constructs-created-in-the-databases" class="md-nav__link">
    <span class="md-ellipsis">
      
        OVN Constructs created in the databases
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ovn-sbdb-flows-generated" class="md-nav__link">
    <span class="md-ellipsis">
      
        OVN SBDB Flows generated
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-tenant-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi Tenant Isolation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acl-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        ACL Logging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensuring-nbdb-objects-are-correctly-created" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ensuring NBDB objects are correctly created
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ovn-tracing" class="md-nav__link">
    <span class="md-ellipsis">
      
        OVN Tracing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices-and-gotchas" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices and Gotchas!
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-limitations-and-design-choices-of-ovn-kubernetes-anp-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Known Limitations and Design Choices of OVN-Kubernetes ANP Implementation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-limitations-and-design-choices-of-anp-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Known Limitations and Design Choices of ANP API
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-items" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Items
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../network-policy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NetworkPolicy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../egress-firewall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressFirewall
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    ClusterEgressControls
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    ClusterEgressControls
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster-egress-controls/egress-ip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressIP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster-egress-controls/egress-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressService
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster-egress-controls/egress-qos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressQoS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cluster-egress-controls/egress-gateway/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressGateway
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    InfrastructureSecurityControls
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    InfrastructureSecurityControls
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure-security-controls/node-identity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NodeIdentity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    MultiNetworking
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    MultiNetworking
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../multiple-networks/multi-homing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multihoming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../multiple-networks/multi-network-policies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MultiNetworkPolicies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../multiple-networks/multi-vtep/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MultiNetworkRails
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../multicast/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multicast
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    NetworkQoS
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    NetworkQoS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network-qos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network-qos-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Usage Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../live-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubevirt VM Live Migration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hybrid-overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HybridOverlay
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_10" >
        
          
          <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Hardware Acceleration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Hardware Acceleration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware-offload/ovs-kernel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OVS Acceleration with kernel datapath
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware-offload/ovs-doca/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OVS Acceleration with DOCA datapath
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_11" >
        
          
          <label class="md-nav__link" for="__nav_5_11" id="__nav_5_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    BGP Integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    BGP Integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bgp-integration/route-advertisements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Route Advertisements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Troubleshooting
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/ovnkube-trace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OVNKube Trace
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Observability
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Observability
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../observability/metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Metrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../observability/sdn-dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SDN Dashboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../observability/ovn-observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OVN observability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Enhancement Proposals
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Enhancement Proposals
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../okeps/okep-5085-localnet-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Localnet API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../okeps/okep-4380-network-qos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network QoS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../okeps/okep-5193-user-defined-networks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    User Defined Networks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../okeps/okep-5233-preconfigured-udn-addresses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Preconfigured UDN Addresses
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../okeps/okep-5296-bgp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BGP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../okeps/okep-5094-layer2-transit-router/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Layer2TransitRouter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../okeps/okep-5494-ovn-kubernetes-mcp-server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP for Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../okeps/okep-5552-dynamic-udn-node-allocation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dynamic UDN Node Allocation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../okeps/okep-5224-connecting-udns/okep-5224-connecting-udns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connecting User Defined Networks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../okeps/okep-5259-no-overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    No-Overlay Mode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../okeps/okep-5088-evpn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EVPN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../okeps/okep-5674-dpu-healthcheck/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DPU Healthcheck
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../blog/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Motivation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Motivation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-storiesuse-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        User-Stories/Use-Cases
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-enable-this-feature-on-an-ovn-kubernetes-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to enable this feature on an OVN-Kubernetes cluster?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow-description" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow Description
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-facing-api-changes" class="md-nav__link">
    <span class="md-ellipsis">
      
        User facing API Changes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User facing API Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adminnetworkpolicy-sample-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        AdminNetworkPolicy Sample API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#baselineadminnetworkpolicy-sample-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        BaselineAdminNetworkPolicy Sample API
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ovn-kubernetes-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        OVN-Kubernetes Implementation Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OVN-Kubernetes Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pass-action-delegate-decision-to-networkpolicies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pass Action: Delegate decision to NetworkPolicies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-action-delegate-decision-to-baselineadminnetworkpolicies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pass Action: Delegate decision to BaselineAdminNetworkPolicies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ovn-constructs-created-in-the-databases" class="md-nav__link">
    <span class="md-ellipsis">
      
        OVN Constructs created in the databases
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ovn-sbdb-flows-generated" class="md-nav__link">
    <span class="md-ellipsis">
      
        OVN SBDB Flows generated
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-tenant-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi Tenant Isolation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acl-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        ACL Logging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensuring-nbdb-objects-are-correctly-created" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ensuring NBDB objects are correctly created
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ovn-tracing" class="md-nav__link">
    <span class="md-ellipsis">
      
        OVN Tracing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices-and-gotchas" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices and Gotchas!
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-limitations-and-design-choices-of-ovn-kubernetes-anp-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Known Limitations and Design Choices of OVN-Kubernetes ANP Implementation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-limitations-and-design-choices-of-anp-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Known Limitations and Design Choices of ANP API
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-items" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Items
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                




  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
      
        
  
  
    
    
      
  
  
    
    
      <li class="md-path__item">
        <a href="../../user-defined-networks/user-defined-networks/" class="md-path__link">
          
  <span class="md-ellipsis">
    Features
  </span>

        </a>
      </li>
    
  

    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="./" class="md-path__link">
          
  <span class="md-ellipsis">
    NetworkSecurityControls
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="adminnetworkpolicy">AdminNetworkPolicy<a class="headerlink" href="#adminnetworkpolicy" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Being able to enforce airtight application security at the cluster-wide level
has been a popular ask from cluster administrators. Key admin user stories include:</p>
<ul>
<li>As a cluster administrator, I want to enforce non-overridable admin network
  policies that have to be adhered to by all user tenants in the cluster, thus
  securing my clusters network traffic.</li>
<li>As a cluster administrator, I want to implement specific network restrictions
  across multiple tenants (a tenant here refers to one or more namespaces),
  thus facilitating network multi-tenancy.</li>
<li>As a cluster administrator, I want to enforce the tenant isolation model
  (a tenant cannot receive traffic from any other tenant) as the clusters default
  network security standard, thus delegating the responsibility of explicitly allowing
  traffic from other tenants to the tenant owner using NetworkPolicies.</li>
</ul>
<p>AdminNetworkPolicy has been designed precisely to solve these problems. It provides
a comprehensive cluster-wide network security solution for cluster administrators using
two cluster-scoped CRDs:</p>
<ul>
<li>AdminNetworkPolicy API and</li>
<li>BaselineAdminNetworkPolicy API</li>
</ul>
<p>which are shipped by the <a href="https://network-policy-api.sigs.k8s.io/">sig-network-policy-api</a>
working group as out-of-tree Kubernetes APIs. Both these APIs can be used to define
cluster-wide admin policies in order to secure your clusters network traffic. These APIs
are currently in the v1alpha1 version and subject to change based on upstream developments
before becoming stable v1.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/">NetworkPolicies</a>
in Kubernetes were created for developers to be able to secure their applications. Hence they
are under the control of potentially untrusted application authors. They are namespace scoped
and are not suitable for solving the above user stories for cluster administrators because:</p>
<ul>
<li>They are not cluster-scoped and hence its hard to define a network of policies
  that spans across namespaces - you'd have to duplicate the same policy over and over
  in each namespace</li>
<li>They cannot be created before the namespace is created (KAPI server expects the namespace
  to be created first since it's namespace scoped); thus they cannot satisfy the requirements
  where admins may want the policies to be applicable to arbitrary future
  namespaces that could get created in the cluster.</li>
</ul>
<p>Another motivation was to fix some of the usability aspects of the NetworkPolicy API.
NetworkPolicy API is designed with an implicit deny-all policy, meaning that with the
first created policy all traffic not allowed by it will be denied. NetworkPolicy only
defines which connection will be allowed. Then we make other exceptions like <code>except</code>
blocks in <code>ipBlock</code> construct which is an explicit what not to allow within the allowList.
Network administrators prefer to have the power of defining what exactly to deny and
allow instead of this implicit model.</p>
<h3 id="user-storiesuse-cases">User-Stories/Use-Cases<a class="headerlink" href="#user-storiesuse-cases" title="Permanent link">&para;</a></h3>
<p>Check out the original <a href="https://network-policy-api.sigs.k8s.io/user-stories/">User Stories</a>
for AdminNetworkPolicy. Follow the new developments for this API via the
<a href="https://network-policy-api.sigs.k8s.io/enhancements/">Network Policy Enhancement Proposals</a>.
Let us look at some practical use cases of when to use admin network policies
in your cluster:</p>
<ul>
<li>Isolate tenants</li>
</ul>
<p><img alt="isolate-tenants" src="../../../images/isolate-tenants.png" /></p>
<ul>
<li>Always allow egress traffic from all workloads to DNS namespace or splunk namespace</li>
</ul>
<p><img alt="allow-egress-to-dns" src="../../../images/allow-egress-to-dns.png" /></p>
<ul>
<li>Always allow ingress traffic from monitoring namespace to all workloads</li>
</ul>
<p><img alt="allow-ingress-from-monitoring" src="../../../images/allow-ingress-from-monitoring.png" /></p>
<ul>
<li>Delegate to namespace scoped network policies (we will learn more about what this is
  in the following sections)</li>
</ul>
<p><img alt="delegate-sample" src="../../../images/delegate-sample.png" /></p>
<ul>
<li>Always deny traffic to sensitive namespaces from everywhere</li>
</ul>
<p><img alt="sensitive-deny" src="../../../images/sensitive-deny.png" /></p>
<h2 id="how-to-enable-this-feature-on-an-ovn-kubernetes-cluster">How to enable this feature on an OVN-Kubernetes cluster?<a class="headerlink" href="#how-to-enable-this-feature-on-an-ovn-kubernetes-cluster" title="Permanent link">&para;</a></h2>
<p>This feature is enabled by default on all OVN-Kubernetes clusters.
You don't need to do anything extra to start using this feature.
There is a Feature Config option <code>enable-admin-network-policy</code> under
<code>OVNKubernetesFeatureConfig</code> config that can be used to disable this
feature. However note that disabling the feature will not remove
existing CRs in the cluster.</p>
<p>When the feature is enabled, the CRDs are installed on the cluster
and the <code>AdminNetworkPolicy</code> controller is invoked.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>crd<span class="w"> </span>adminnetworkpolicies.policy.networking.k8s.io
NAME<span class="w">                                            </span>CREATED<span class="w"> </span>AT
adminnetworkpolicies.policy.networking.k8s.io<span class="w">   </span><span class="m">2023</span>-10-01T11:33:58Z
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>crd<span class="w"> </span>baselineadminnetworkpolicies.policy.networking.k8s.io
NAME<span class="w">                                                    </span>CREATED<span class="w"> </span>AT
baselineadminnetworkpolicies.policy.networking.k8s.io<span class="w">   </span><span class="m">2023</span>-10-01T11:33:58Z
</code></pre></div>
<h2 id="workflow-description">Workflow Description<a class="headerlink" href="#workflow-description" title="Permanent link">&para;</a></h2>
<h2 id="implementation-details">Implementation Details<a class="headerlink" href="#implementation-details" title="Permanent link">&para;</a></h2>
<h3 id="user-facing-api-changes">User facing API Changes<a class="headerlink" href="#user-facing-api-changes" title="Permanent link">&para;</a></h3>
<p>Like mentioned above, the API lives in the
<a href="https://github.com/kubernetes-sigs/network-policy-api">kubernetes-sigs</a> repo.</p>
<h4 id="adminnetworkpolicy-sample-api">AdminNetworkPolicy Sample API<a class="headerlink" href="#adminnetworkpolicy-sample-api" title="Permanent link">&para;</a></h4>
<p>Let us look at a sample ANP yaml:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy.networking.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AdminNetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster-control</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">34</span>
<span class="w">  </span><span class="nt">subject</span><span class="p">:</span>
<span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;allow-from-ingress-nginx&quot;</span><span class="w"> </span><span class="c1"># rule0</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Allow&quot;</span>
<span class="w">    </span><span class="nt">from</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">kubernetes.io/metadata.name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;allow-from-monitoring&quot;</span><span class="w"> </span><span class="c1"># rule1</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Allow&quot;</span>
<span class="w">    </span><span class="nt">from</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">kubernetes.io/metadata.name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">portNumber</span><span class="p">:</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7564</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namedPort</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;scrape&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;allow-from-open-tenants&quot;</span><span class="w"> </span><span class="c1"># rule2</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Allow&quot;</span>
<span class="w">    </span><span class="nt">from</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="c1"># open tenants</span>
<span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">open</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pass-from-restricted-tenants&quot;</span><span class="w"> </span><span class="c1"># rule3</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Pass&quot;</span>
<span class="w">    </span><span class="nt">from</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="c1"># restricted tenants</span>
<span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default-deny&quot;</span><span class="w"> </span><span class="c1"># rule4</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deny&quot;</span>
<span class="w">    </span><span class="nt">from</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;allow-to-dns&quot;</span><span class="w"> </span><span class="c1"># rule0</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Allow&quot;</span>
<span class="w">    </span><span class="nt">to</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pods</span><span class="p">:</span>
<span class="w">        </span><span class="nt">namespaceSelector</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">kubernetes.io/metadata.name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="w">        </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dns</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">portNumber</span><span class="p">:</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5353</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;allow-to-kapi-server&quot;</span><span class="w"> </span><span class="c1"># rule1</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Allow&quot;</span>
<span class="w">    </span><span class="nt">to</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">nodes</span><span class="p">:</span>
<span class="w">        </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node-role.kubernetes.io/control-plane</span>
<span class="w">          </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Exists</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">portNumber</span><span class="p">:</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6443</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;allow-to-splunk&quot;</span><span class="w"> </span><span class="c1"># rule2</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Allow&quot;</span>
<span class="w">    </span><span class="nt">to</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">splunk</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">portNumber</span><span class="p">:</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8991</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">portNumber</span><span class="p">:</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8992</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;allow-to-open-tenants-and-intranet-and-worker-nodes&quot;</span><span class="w"> </span><span class="c1"># rule3</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Allow&quot;</span>
<span class="w">    </span><span class="nt">to</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">nodes</span><span class="p">:</span><span class="w"> </span><span class="c1"># worker-nodes</span>
<span class="w">        </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node-role.kubernetes.io/worker</span>
<span class="w">          </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Exists</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">networks</span><span class="p">:</span><span class="w"> </span><span class="c1"># intranet</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.30.0.0/30</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.54.0/19</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.56.38/32</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.69.0/24</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="c1"># open tenants</span>
<span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">open</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pass-to-restricted-tenants&quot;</span><span class="w"> </span><span class="c1"># rule4</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Pass&quot;</span>
<span class="w">    </span><span class="nt">to</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="c1"># restricted tenants</span>
<span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default-deny&quot;</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deny&quot;</span>
<span class="w">    </span><span class="nt">to</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
</code></pre></div>
<ul>
<li><code>subject</code> is the set of pods selected by <code>cluster-control</code> ANP, on
  which the rules in the policy are applied on. Here its all the pods
  in the cluster.</li>
<li>Each AdminNetworkPolicy resource will have a<code>.spec.priority</code> field. <code>priority</code>
  is 34 here that determines the priority of this ANP versus other
  ANPs in your cluster.  The lower the number the higher the precedence.
  Thus 0 is the highest priority and 99 (the largest number supported
  by OVN-Kubernetes) is the lowest priority.</li>
<li><code>ingress</code> has 5 rules:<ul>
<li>rule0: always allow ingress traffic coming from ingress-nginx namespace
  to all the pods in the cluster</li>
<li>rule1: always allow TCP ingress traffic coming from port 7564 of
  pods in monitoring namespace</li>
<li>rule2: always allow all ingress traffic from <code>open</code> tenant's namespaces</li>
<li>rule3: always pass all ingress traffic from <code>restricted</code> tenant's namespaces
  (please check the following sections to learn more about what <code>pass</code> is)</li>
<li>rule4: deny all other ingress traffic including same namespace pods</li>
</ul>
</li>
<li><code>egress</code> has 6 rules:<ul>
<li>rule0: always allow egress traffic coming from all pods to dns pods</li>
<li>rule1: always allow TCP egress traffic coming from all pods to KAPI pods</li>
<li>rule2: always allow all egress traffic coming from all pods to splunk logging
  tenant at TCP ports 8991 and 8992</li>
<li>rule3: always allow all egress traffic to <code>open</code> tenant's namespaces, company's
  intranet CIDR ranges and all worker nodes in the cluster</li>
<li>rule4: always pass all egress traffic to <code>restricted</code> tenant's namespaces
  (please check the following sections to learn more about what <code>pass</code> is)</li>
<li>rule5: deny all other egress traffic including same namespace pods</li>
</ul>
</li>
</ul>
<p>You can do <code>oc apply -f cluster-control.yaml</code> to create this ANP in your cluster
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>anp
NAME<span class="w">              </span>PRIORITY<span class="w">   </span>AGE
cluster-control<span class="w">   </span><span class="m">34</span><span class="w">         </span>3s
</code></pre></div></p>
<h4 id="baselineadminnetworkpolicy-sample-api">BaselineAdminNetworkPolicy Sample API<a class="headerlink" href="#baselineadminnetworkpolicy-sample-api" title="Permanent link">&para;</a></h4>
<p>Unlike ANP's BANP is a singleton object in your
cluster. BANP specifies baseline policies that apply
unless they are overridden by a NetworkPolicy or ANP.</p>
<p>Let us look at a sample BANP yaml:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy.networking.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BaselineAdminNetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">subject</span><span class="p">:</span>
<span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default-deny&quot;</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deny&quot;</span>
<span class="w">    </span><span class="nt">from</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default-deny&quot;</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deny&quot;</span>
<span class="w">    </span><span class="nt">to</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div>
<p>You can do <code>oc apply -f default.yaml</code> to create this ANP in your cluster
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>banp
NAME<span class="w">      </span>AGE
default<span class="w">   </span>16m
</code></pre></div></p>
<p>Note that when you use <code>{}</code> selectors to select pods
you are selecting ALL the pods in the cluster including
<code>kube-system</code> and <code>ovn-kubernetes</code> namespaces which is
something you probably don't want to do. If you do this,
then the cluster will go into a non-functional state since
basic infrastructued pods cannot communicate unless you
explicitly define higher priority allow rules.</p>
<p>Almost always you probably need a policy that looks like:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy.networking.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BaselineAdminNetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">subject</span><span class="p">:</span>
<span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all-workload-namespaces</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default-deny&quot;</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deny&quot;</span>
<span class="w">    </span><span class="nt">from</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all-workload-namespaces</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default-deny&quot;</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deny&quot;</span>
<span class="w">    </span><span class="nt">to</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all-workload-namespaces</span>
</code></pre></div></p>
<h3 id="ovn-kubernetes-implementation-details">OVN-Kubernetes Implementation Details<a class="headerlink" href="#ovn-kubernetes-implementation-details" title="Permanent link">&para;</a></h3>
<p>We have a new level driven controller in OVN-Kubernetes
called <a href="https://github.com/ovn-org/ovn-kubernetes/tree/master/go-controller/pkg/ovn/controller/admin_network_policy">admin_network_policy</a>
which watches for the following objects:</p>
<ul>
<li>AdminNetworkPolicy</li>
<li>BaselineAdminNetworkPolicy</li>
<li>Namespaces</li>
<li>Pods</li>
<li>Nodes</li>
</ul>
<p>in your cluster. For each add, update and delete event
that this controller cares about for each of the above
objects, it add's it to the centralized ANP and BANP
queue in a single threaded fashion.</p>
<p>The controller maintains an internal cache state for each
corresponding ANP and tries to level the current state
configuration for a given ANP with the desired state
configuration for that ANP.</p>
<p>It also emits events like <code>ANPWithUnsupportedPriority</code> and
<code>ANPWithDuplicatePriority</code> so that users are aware in those
circumstances.</p>
<h4 id="pass-action-delegate-decision-to-networkpolicies">Pass Action: Delegate decision to NetworkPolicies<a class="headerlink" href="#pass-action-delegate-decision-to-networkpolicies" title="Permanent link">&para;</a></h4>
<p>In addition to setting <code>Deny</code> and <code>Allow</code> actions on ANP API rules,
one can also use the <code>Pass</code> action for a rule. What this means is
ANP controller defers the decision of connections that match the pass
action rule to either the NetworkPolicy OR to the BaselineAdminNetworkPolicy
defined in the cluster (if either of them match the same set of pods,
then they will take effect and if not, the result will be an <code>Allow</code>).
Order of precedence: <code>AdminNetworkPolicy (Tier1) &gt; NetworkPolicy(Tier2) &gt; BaselineAdminNetworkPolicy (Tier3)</code>.</p>
<p><img alt="precedence" src="../../../images/precedence.png" /></p>
<p>Ingress rule3 and Egress rule4 are examples of <code>Pass</code> action. Such
rules are created when the administrator wants to delegate the decision
of whether that connection should be allowed or not to NetworkPolicies
defined by tenant owners.</p>
<p>If we now define a network policy in <code>restricted</code> tenant's namespace
that matches on same ingress peers as in the subject of our <code>cluster-control</code>
admin network policy, that network policy will take effect.
This is how administrators can delegate a decision making to the namespace
owners in a cluster.</p>
<h4 id="pass-action-delegate-decision-to-baselineadminnetworkpolicies">Pass Action: Delegate decision to BaselineAdminNetworkPolicies<a class="headerlink" href="#pass-action-delegate-decision-to-baselineadminnetworkpolicies" title="Permanent link">&para;</a></h4>
<p>Since we can delegate decisions from administrators to namespace owners,
what if namespace owners don't have policies in place for the same set of
subjects? Admins in such cases might want to keep a default set of guardrails
in the cluster. Thus we allow one BANP to be created in the cluster with the
name <code>default</code>. BANP doesn't have any priority field, since we can have only
one in the cluster. Rest of the implementation details for ANP is applicable
to BANP as well.</p>
<h4 id="ovn-constructs-created-in-the-databases">OVN Constructs created in the databases<a class="headerlink" href="#ovn-constructs-created-in-the-databases" title="Permanent link">&para;</a></h4>
<ul>
<li>Each AdminNetworkPolicy CRD can have upto 100 ingress rules and 100 egress rules,
  thus 200 rules in total. The ordering of each rule is important. If the rule is
  at the top of the list then it has the highest precedence and if the rule is
  at the bottom it has the lowest precedence. Each rule translates to <code>nbdb.ACL</code>.
  We will have:<ul>
<li>one single <code>nbdb.ACL</code> if <code>len(rule.ports) == 0 &amp;&amp; len(rule.namedPorts) == 0</code></li>
<li>one <code>nbdb.ACL</code> per protocol if <code>len(rule.ports) &gt; 0 and len(rule.namedPorts) == 0</code>
  (so max 3 <code>nbdb.ACLs</code> (tcp,udp,sctp) per rule {<code>portNumber</code>, <code>portRange</code> type ports ONLY})</li>
<li>one <code>nbdb.ACL</code> per protocol if <code>len(rule.namedPorts) &gt; 0 and len(rule.ports) == 0</code>
  (so max 3 ACLs (tcp,udp,sctp) per rule {<code>namedPort</code> type ports ONLY})</li>
<li>one ACL per protocol if <code>len(rule.ports) &gt; 0</code> and one ACL per protocol <code>if len(rule.namedPorts) &gt; 0</code>
(so max 6 ACLs (2tcp,2udp,2sctp) per rule {<code>portNumber</code>, <code>portRange</code>, <code>namedPorts</code> all are present})</li>
</ul>
</li>
<li>Since we can have upto 100 policies and each one can have upto 100 gress rules
  (100*100), we have blocked out the range: 30,000 - 20,000 priority range for
  the OVN <code>nbdb.ACL</code> table in the <code>Tier1</code> block for ANP's implementation.</li>
<li>Since we can have only 1 BANP in the cluster, we keep <code>nbdb.ACL</code>'s priority range
  1750 - 1649 range reserved for BANP ACLs in the <code>Tier3</code> block for BANP's implementation.</li>
<li>Each AdminNetworkPolicy CRD will have a subject on which the policy is 
  applied on - this is translated to one <code>nbdb.PortGroup</code> on which the <code>nbdb.ACLs</code>
  of each rule in the policy are attached on. So there is one <code>nbdb.PortGroup</code> per ANP created.</li>
<li>Each gress rule can have upto 100 peers. Each rule will also create an <code>nbdb.AddressSet</code>
  which will contain the IPs of all the pods, nodes and networks that are selected
  by the peer selector across all the peers of that given rule.</li>
</ul>
<p>For the ANP created above, let us look at how these OVN constructs would
look like using the following commands:</p>
<p>NOTE: All commands must be run inside the ovnkube-node pod for
interconnect mode and ovnkube-master pod for default mode since
that is where the NBDB container is running.</p>
<p><code>nbdb.ACL</code>: These can be listed using <code>ovn-nbctl list acl</code></p>
<p>The Ingress ACLs for the above AdminNetworkPolicy are:</p>
<div class="highlight"><pre><span></span><code>_uuid<span class="w">               </span>:<span class="w"> </span>f4523ce3-fb80-4d68-a50b-8aa6a795f895
action<span class="w">              </span>:<span class="w"> </span>allow-related
direction<span class="w">           </span>:<span class="w"> </span>to-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Ingress:0:None&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>None<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;outport == @a14645450421485494999 &amp;&amp; ((ip4.src == </span><span class="nv">$a14545668191619617708</span><span class="s2">))&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;ANP:cluster-control:Ingress:0&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">26600</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">1</span>

_uuid<span class="w">               </span>:<span class="w"> </span>4117970c-c138-45b5-a6de-8e5e54efcb04
action<span class="w">              </span>:<span class="w"> </span>allow-related
direction<span class="w">           </span>:<span class="w"> </span>to-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;1&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Ingress:1:tcp&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>tcp<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;outport == @a14645450421485494999 &amp;&amp; ((ip4.src == </span><span class="nv">$a6786643370959569281</span><span class="s2">)) &amp;&amp; tcp &amp;&amp; tcp.dst==7564&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;ANP:cluster-control:Ingress:1&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">26599</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">1</span>

_uuid<span class="w">               </span>:<span class="w"> </span>1b1b1409-b96a-4e6d-9776-00d88c0c7ac9
action<span class="w">              </span>:<span class="w"> </span>allow-related
direction<span class="w">           </span>:<span class="w"> </span>to-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;1&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Ingress:1:tcp-namedPort&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>tcp-namedPort<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;((ip4.src == </span><span class="nv">$a6786643370959569281</span><span class="s2">)) &amp;&amp; tcp &amp;&amp; ((ip4.dst == 10.244.1.4 &amp;&amp; tcp.dst == 8080) || (ip4.dst == 10.244.2.8 &amp;&amp; tcp.dst == 8080) || (ip4.dst == 10.244.2.8 &amp;&amp; tcp.dst == 8080))&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;ANP:cluster-control:Ingress:1&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">26599</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">1</span>

_uuid<span class="w">               </span>:<span class="w"> </span>00400c05-7225-4d64-9428-8b2a04c6c3da
action<span class="w">              </span>:<span class="w"> </span>allow-related
direction<span class="w">           </span>:<span class="w"> </span>to-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;2&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Ingress:2:None&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>None<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;outport == @a14645450421485494999 &amp;&amp; ((ip4.src == </span><span class="nv">$a13730899355151937870</span><span class="s2">))&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;ANP:cluster-control:Ingress:2&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">26598</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">1</span>

_uuid<span class="w">               </span>:<span class="w"> </span>7f5ea19b-d465-4de4-8369-bdf66fdcd7d9
action<span class="w">              </span>:<span class="w"> </span>pass
direction<span class="w">           </span>:<span class="w"> </span>to-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;3&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Ingress:3:None&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>None<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;outport == @a14645450421485494999 &amp;&amp; ((ip4.src == </span><span class="nv">$a764182844364804195</span><span class="s2">))&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;ANP:cluster-control:Ingress:3&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">26597</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">1</span>

_uuid<span class="w">               </span>:<span class="w"> </span>3e82df77-ad40-4dce-bd96-5b9e7e0b3603
action<span class="w">              </span>:<span class="w"> </span>drop
direction<span class="w">           </span>:<span class="w"> </span>to-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Ingress:4:None&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>None<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;outport == @a14645450421485494999 &amp;&amp; ((ip4.src == </span><span class="nv">$a13814616246365836720</span><span class="s2">))&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;ANP:cluster-control:Ingress:4&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">26596</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">1</span>
</code></pre></div>
<p>The Egress ACLs for the above AdminNetworkPolicy are:</p>
<div class="highlight"><pre><span></span><code>_uuid<span class="w">               </span>:<span class="w"> </span>fdb266b7-758a-4471-9cc1-84d00dc4f2ae
action<span class="w">              </span>:<span class="w"> </span>allow-related
direction<span class="w">           </span>:<span class="w"> </span>from-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Egress:0:udp&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>udp<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;inport == @a14645450421485494999 &amp;&amp; ((ip4.dst == </span><span class="nv">$a13517855690389298082</span><span class="s2">)) &amp;&amp; udp &amp;&amp; udp.dst==5353&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;ANP:cluster-control:Egress:0&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{</span>apply-after-lb<span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">26600</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">1</span>

_uuid<span class="w">               </span>:<span class="w"> </span>8f1b8170-c350-4e9d-8ff0-a3177f9749ca
action<span class="w">              </span>:<span class="w"> </span>allow-related
direction<span class="w">           </span>:<span class="w"> </span>from-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;1&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Egress:1:tcp&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>tcp<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;inport == @a14645450421485494999 &amp;&amp; ((ip4.dst == </span><span class="nv">$a10706246167277696183</span><span class="s2">)) &amp;&amp; tcp &amp;&amp; tcp.dst==6443&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;ANP:cluster-control:Egress:1&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{</span>apply-after-lb<span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">26599</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">1</span>

_uuid<span class="w">               </span>:<span class="w"> </span>04dbde8f-eaa8-4973-a158-ec56d0be672f
action<span class="w">              </span>:<span class="w"> </span>allow-related
direction<span class="w">           </span>:<span class="w"> </span>from-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;2&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Egress:2:tcp&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>tcp<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;inport == @a14645450421485494999 &amp;&amp; ((ip4.dst == </span><span class="nv">$a18396736153283155648</span><span class="s2">)) &amp;&amp; tcp &amp;&amp; tcp.dst=={8991,8992}&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;ANP:cluster-control:Egress:2&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{</span>apply-after-lb<span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">26598</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">1</span>

_uuid<span class="w">               </span>:<span class="w"> </span>c37d0794-8444-440e-87d0-02ef95c6e248
action<span class="w">              </span>:<span class="w"> </span>allow-related
direction<span class="w">           </span>:<span class="w"> </span>from-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;3&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Egress:3:None&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>None<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;inport == @a14645450421485494999 &amp;&amp; ((ip4.dst == </span><span class="nv">$a10622494091691694581</span><span class="s2">))&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;ANP:cluster-control:Egress:3&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{</span>apply-after-lb<span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">26597</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">1</span>

_uuid<span class="w">               </span>:<span class="w"> </span>2f3292f0-9676-4d02-a553-230c3a2885b8
action<span class="w">              </span>:<span class="w"> </span>pass
direction<span class="w">           </span>:<span class="w"> </span>from-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Egress:4:None&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>None<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;inport == @a14645450421485494999 &amp;&amp; ((ip4.dst == </span><span class="nv">$a5972452606168369118</span><span class="s2">))&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;ANP:cluster-control:Egress:4&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{</span>apply-after-lb<span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">26596</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">1</span>

_uuid<span class="w">               </span>:<span class="w"> </span>924b81fd-65cc-494b-9c29-0c5287d69bb1
action<span class="w">              </span>:<span class="w"> </span>drop
direction<span class="w">           </span>:<span class="w"> </span>from-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;5&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Egress:5:None&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>None<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;inport == @a14645450421485494999 &amp;&amp; ((ip4.dst == </span><span class="nv">$a11452480169090787059</span><span class="s2">))&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;ANP:cluster-control:Egress:5&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{</span>apply-after-lb<span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">26595</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">1</span>
</code></pre></div>
<p><code>nbdb.AdressSet</code>: These can be listed using <code>ovn-nbctl list address-set</code></p>
<p>The Ingress Address-Sets for the above AdminNetworkPolicy are:</p>
<div class="highlight"><pre><span></span><code>_uuid<span class="w">               </span>:<span class="w"> </span>c51329b3-e1f6-48b7-b674-129819279bbe
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.244.2.5&quot;</span><span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Ingress:0:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a14545668191619617708

_uuid<span class="w">               </span>:<span class="w"> </span>7e9e5dcd-8576-443b-8f32-0b31dca64e06
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.244.1.4&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.8&quot;</span><span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;1&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Ingress:1:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a6786643370959569281

_uuid<span class="w">               </span>:<span class="w"> </span>59c30748-af15-4a75-8f0c-a36eb134bbca
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;2&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Ingress:2:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a13730899355151937870

_uuid<span class="w">               </span>:<span class="w"> </span>191ea649-5849-4147-b07b-3f252c59cddb
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.244.1.3&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.7&quot;</span><span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;3&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Ingress:3:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a764182844364804195

_uuid<span class="w">               </span>:<span class="w"> </span>562cc870-5be5-43a4-a996-be3814ca5e49
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.244.1.3&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.1.4&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.3&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.4&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.5&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.6&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.7&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.8&quot;</span><span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;4&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Ingress:4:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a13814616246365836720
</code></pre></div>
<p>The Egress Address-Sets for the above AdminNetworkPolicy are:</p>
<div class="highlight"><pre><span></span><code>_uuid<span class="w">               </span>:<span class="w"> </span>fef274ee-28bd-4c05-8e6a-893283fbd84c
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.244.1.3&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.1.4&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.3&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.4&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.5&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.6&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.7&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.8&quot;</span><span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Egress:0:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a13517855690389298082

_uuid<span class="w">               </span>:<span class="w"> </span>ec77552f-f895-4f35-aa52-a4e44cb06e7e
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;172.18.0.3&quot;</span><span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;1&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Egress:1:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a10706246167277696183

_uuid<span class="w">               </span>:<span class="w"> </span>b406e4a6-4dba-4d03-96b5-383b2c6a44a4
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.244.1.3&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.1.4&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.3&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.4&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.5&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.6&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.7&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.8&quot;</span><span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;2&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Egress:2:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a18396736153283155648

_uuid<span class="w">               </span>:<span class="w"> </span>42e115fb-d1cb-437b-b3c0-dbf23c46e3b1
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.0.54.26/32&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.0.56.38/32&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.0.69.31/32&quot;</span>,<span class="w"> </span><span class="s2">&quot;172.30.0.1/32&quot;</span><span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;3&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Egress:3:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a10622494091691694581

_uuid<span class="w">               </span>:<span class="w"> </span><span class="m">77554661</span>-34c7-4d24-82e2-819c9be98e55
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.244.1.3&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.7&quot;</span><span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;4&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Egress:4:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a5972452606168369118

_uuid<span class="w">               </span>:<span class="w"> </span>c8b87fe8-dd6c-4ef3-8cea-e7ea8a5bdb3d
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;0.0.0.0/0&quot;</span><span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;5&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control:Egress:5:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a11452480169090787059
</code></pre></div>
<p>The <code>nbdb.PortGroup</code> created by the above ACL is:</p>
<div class="highlight"><pre><span></span><code>_uuid<span class="w">               </span>:<span class="w"> </span>ff405445-be4f-4cde-8660-ee740c628f61
acls<span class="w">                </span>:<span class="w"> </span><span class="o">[</span>00400c05-7225-4d64-9428-8b2a04c6c3da,<span class="w"> </span>04dbde8f-eaa8-4973-a158-ec56d0be672f,<span class="w"> </span>1b1b1409-b96a-4e6d-9776-00d88c0c7ac9,<span class="w"> </span>2f3292f0-9676-4d02-a553-230c3a2885b8,<span class="w"> </span>3e82df77-ad40-4dce-bd96-5b9e7e0b3603,<span class="w"> </span>4117970c-c138-45b5-a6de-8e5e54efcb04,<span class="w"> </span>7f5ea19b-d465-4de4-8369-bdf66fdcd7d9,<span class="w"> </span>8f1b8170-c350-4e9d-8ff0-a3177f9749ca,<span class="w"> </span>924b81fd-65cc-494b-9c29-0c5287d69bb1,<span class="w"> </span>c37d0794-8444-440e-87d0-02ef95c6e248,<span class="w"> </span>f4523ce3-fb80-4d68-a50b-8aa6a795f895,<span class="w"> </span>fdb266b7-758a-4471-9cc1-84d00dc4f2ae<span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:AdminNetworkPolicy:cluster-control&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>cluster-control,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>AdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a14645450421485494999
ports<span class="w">               </span>:<span class="w"> </span><span class="o">[</span>050c1f3d-fe1d-4d40-8f3a-9e21d09f0506,<span class="w"> </span>30b5ed88-005a-4c86-80bb-6850173dec4b,<span class="w"> </span>4f14f82b-2ec2-4b40-a6a7-7303105e45bb,<span class="w"> </span>6868266a-b06f-4660-a5b6-394c0dbaf16b,<span class="w"> </span>d3196102-853f-4c4a-af60-01b0047fc48b,<span class="w"> </span>f44a954f-3a57-4b62-ac89-5a4b55eebf5c<span class="o">]</span>
</code></pre></div>
<p>For the ANP created above, let us look at how these OVN constructs would
look like:</p>
<p><code>nbdb.PortGroup</code>:</p>
<div class="highlight"><pre><span></span><code>_uuid<span class="w">               </span>:<span class="w"> </span>32648b42-e9f9-48e8-a1b0-78526fb60a41
acls<span class="w">                </span>:<span class="w"> </span><span class="o">[</span>c3c90b09-a68d-4d7f-aade-4aa17df798a8,<span class="w"> </span>ea9660bd-d118-4e26-8280-5e7520fa9e9c<span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:BaselineAdminNetworkPolicy:default&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>default,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>BaselineAdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a9550609891683691927
ports<span class="w">               </span>:<span class="w"> </span><span class="o">[</span>050c1f3d-fe1d-4d40-8f3a-9e21d09f0506,<span class="w"> </span>30b5ed88-005a-4c86-80bb-6850173dec4b,<span class="w"> </span>4f14f82b-2ec2-4b40-a6a7-7303105e45bb,<span class="w"> </span>6868266a-b06f-4660-a5b6-394c0dbaf16b,<span class="w"> </span>d3196102-853f-4c4a-af60-01b0047fc48b,<span class="w"> </span>f44a954f-3a57-4b62-ac89-5a4b55eebf5c<span class="o">]</span>
</code></pre></div>
<p><code>nbdb.ACL</code>:</p>
<div class="highlight"><pre><span></span><code>_uuid<span class="w">               </span>:<span class="w"> </span>c3c90b09-a68d-4d7f-aade-4aa17df798a8
action<span class="w">              </span>:<span class="w"> </span>drop
direction<span class="w">           </span>:<span class="w"> </span>from-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:BaselineAdminNetworkPolicy:default:Egress:0:None&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>default,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>BaselineAdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>None<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;inport == @a9550609891683691927 &amp;&amp; ((ip4.dst == </span><span class="nv">$a17509128412806720482</span><span class="s2">))&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;BANP:default:Egress:0&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{</span>apply-after-lb<span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">1750</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">3</span>

_uuid<span class="w">               </span>:<span class="w"> </span>ea9660bd-d118-4e26-8280-5e7520fa9e9c
action<span class="w">              </span>:<span class="w"> </span>drop
direction<span class="w">           </span>:<span class="w"> </span>to-lport
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:BaselineAdminNetworkPolicy:default:Ingress:0:None&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>default,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>BaselineAdminNetworkPolicy,<span class="w"> </span>port-policy-protocol<span class="o">=</span>None<span class="o">}</span>
label<span class="w">               </span>:<span class="w"> </span><span class="m">0</span>
log<span class="w">                 </span>:<span class="w"> </span><span class="nb">false</span>
match<span class="w">               </span>:<span class="w"> </span><span class="s2">&quot;outport == @a9550609891683691927 &amp;&amp; ((ip4.src == </span><span class="nv">$a168374317940583916</span><span class="s2">))&quot;</span>
meter<span class="w">               </span>:<span class="w"> </span>acl-logging
name<span class="w">                </span>:<span class="w"> </span><span class="s2">&quot;BANP:default:Ingress:0&quot;</span>
options<span class="w">             </span>:<span class="w"> </span><span class="o">{}</span>
priority<span class="w">            </span>:<span class="w"> </span><span class="m">1750</span>
severity<span class="w">            </span>:<span class="w"> </span><span class="o">[]</span>
tier<span class="w">                </span>:<span class="w"> </span><span class="m">3</span>
</code></pre></div>
<p><code>nbdb.AddressSet</code>:</p>
<div class="highlight"><pre><span></span><code>_uuid<span class="w">               </span>:<span class="w"> </span>60ae32d1-b0f9-49c9-ac5a-082bfc4b2c07
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.244.1.3&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.1.4&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.3&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.4&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.5&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.6&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.7&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.8&quot;</span><span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Ingress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:BaselineAdminNetworkPolicy:default:Ingress:0:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>default,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>BaselineAdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a168374317940583916

_uuid<span class="w">               </span>:<span class="w"> </span>9e04c2f6-e5c0-4fe9-a1cc-7a72c277ed08
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.244.1.3&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.1.4&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.3&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.4&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.5&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.6&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.7&quot;</span>,<span class="w"> </span><span class="s2">&quot;10.244.2.8&quot;</span><span class="o">]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{</span><span class="nv">direction</span><span class="o">=</span>Egress,<span class="w"> </span>gress-index<span class="o">=</span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span>ip-family<span class="o">=</span>v4,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/id&quot;</span><span class="o">=</span><span class="s2">&quot;default-network-controller:BaselineAdminNetworkPolicy:default:Egress:0:v4&quot;</span>,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/name&quot;</span><span class="o">=</span>default,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="o">=</span>default-network-controller,<span class="w"> </span><span class="s2">&quot;k8s.ovn.org/owner-type&quot;</span><span class="o">=</span>BaselineAdminNetworkPolicy<span class="o">}</span>
name<span class="w">                </span>:<span class="w"> </span>a17509128412806720482
</code></pre></div>
<h4 id="ovn-sbdb-flows-generated">OVN SBDB Flows generated<a class="headerlink" href="#ovn-sbdb-flows-generated" title="Permanent link">&para;</a></h4>
<p>Sample flows created for policies look like this on 
OVN SBDB level:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">27600</span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">7</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>@a14645450421485494999<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a14545668191619617708</span><span class="o">))))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>log<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Ingress:0&quot;</span>,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>allow,<span class="w"> </span><span class="nv">meter</span><span class="o">=</span><span class="s2">&quot;acl-logging__f4523ce3-fb80-4d68-a50b-8aa6a795f895&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>reg8<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">27600</span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">8</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>@a14645450421485494999<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a14545668191619617708</span><span class="o">))))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>log<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Ingress:0&quot;</span>,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>allow,<span class="w"> </span><span class="nv">meter</span><span class="o">=</span><span class="s2">&quot;acl-logging__f4523ce3-fb80-4d68-a50b-8aa6a795f895&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>reg8<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">27599</span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">7</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a6786643370959569281</span><span class="o">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.1.4<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">8080</span><span class="o">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">(</span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.2.8<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">8080</span><span class="o">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">(</span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.2.8<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">8080</span><span class="o">))))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>log<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Ingress:1&quot;</span>,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>allow,<span class="w"> </span><span class="nv">meter</span><span class="o">=</span><span class="s2">&quot;acl-logging__1b1b1409-b96a-4e6d-9776-00d88c0c7ac9&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>reg8<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">27599</span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">7</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>@a14645450421485494999<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a6786643370959569281</span><span class="o">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp.dst<span class="o">==</span><span class="m">7564</span><span class="o">))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>log<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Ingress:1&quot;</span>,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>allow,<span class="w"> </span><span class="nv">meter</span><span class="o">=</span><span class="s2">&quot;acl-logging__4117970c-c138-45b5-a6de-8e5e54efcb04&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>reg8<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">27599</span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">8</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a6786643370959569281</span><span class="o">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.1.4<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">8080</span><span class="o">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">(</span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.2.8<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">8080</span><span class="o">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">(</span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.2.8<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">8080</span><span class="o">))))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>log<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Ingress:1&quot;</span>,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>allow,<span class="w"> </span><span class="nv">meter</span><span class="o">=</span><span class="s2">&quot;acl-logging__1b1b1409-b96a-4e6d-9776-00d88c0c7ac9&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>reg8<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">27599</span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">8</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>@a14645450421485494999<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a6786643370959569281</span><span class="o">))</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp.dst<span class="o">==</span><span class="m">7564</span><span class="o">))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>log<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Ingress:1&quot;</span>,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>allow,<span class="w"> </span><span class="nv">meter</span><span class="o">=</span><span class="s2">&quot;acl-logging__4117970c-c138-45b5-a6de-8e5e54efcb04&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>reg8<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">27598</span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">7</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>@a14645450421485494999<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a13730899355151937870</span><span class="o">))))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>log<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Ingress:2&quot;</span>,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>allow,<span class="w"> </span><span class="nv">meter</span><span class="o">=</span><span class="s2">&quot;acl-logging__00400c05-7225-4d64-9428-8b2a04c6c3da&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>reg8<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">27598</span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">8</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>@a14645450421485494999<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a13730899355151937870</span><span class="o">))))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>log<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Ingress:2&quot;</span>,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>allow,<span class="w"> </span><span class="nv">meter</span><span class="o">=</span><span class="s2">&quot;acl-logging__00400c05-7225-4d64-9428-8b2a04c6c3da&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>reg8<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">27597</span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>@a14645450421485494999<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a764182844364804195</span><span class="o">))))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>log<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Ingress:3&quot;</span>,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>warning,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>pass,<span class="w"> </span><span class="nv">meter</span><span class="o">=</span><span class="s2">&quot;acl-logging__7f5ea19b-d465-4de4-8369-bdf66fdcd7d9&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">27596</span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">10</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>@a14645450421485494999<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a13814616246365836720</span><span class="o">))))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>log<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Ingress:4&quot;</span>,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>drop,<span class="w"> </span><span class="nv">meter</span><span class="o">=</span><span class="s2">&quot;acl-logging__3e82df77-ad40-4dce-bd96-5b9e7e0b3603&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>reg8<span class="o">[</span><span class="m">17</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>ct_commit<span class="w"> </span><span class="o">{</span><span class="w"> </span>ct_mark.blocked<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="o">}</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">27596</span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">9</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>@a14645450421485494999<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a13814616246365836720</span><span class="o">))))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>log<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Ingress:4&quot;</span>,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>drop,<span class="w"> </span><span class="nv">meter</span><span class="o">=</span><span class="s2">&quot;acl-logging__3e82df77-ad40-4dce-bd96-5b9e7e0b3603&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>reg8<span class="o">[</span><span class="m">17</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">2750</span><span class="w"> </span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">10</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>@a9550609891683691927<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a168374317940583916</span><span class="o">))))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">17</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>ct_commit<span class="w"> </span><span class="o">{</span><span class="w"> </span>ct_mark.blocked<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="o">}</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>ls_out_acl_eval<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">2750</span><span class="w"> </span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">9</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>@a9550609891683691927<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a168374317940583916</span><span class="o">))))</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>reg8<span class="o">[</span><span class="m">17</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
</code></pre></div>
<h2 id="multi-tenant-isolation">Multi Tenant Isolation<a class="headerlink" href="#multi-tenant-isolation" title="Permanent link">&para;</a></h2>
<p>In order to isolate your tenants in the cluster, unlike
network policies you don't need to create 1 policy per namespace.
You need to only create 1 policy per tenant. Sample ANPs for
multi-tenant isolation where we have 4 tenants <code>blue</code>, <code>green</code>,
<code>yellow</code> and <code>red</code> are:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy.networking.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AdminNetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">blue-tenant</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40</span>
<span class="w">  </span><span class="nt">subject</span><span class="p">:</span>
<span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span>
<span class="w">      </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">blue</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
<span class="w">      </span><span class="nt">from</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">blue</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
<span class="w">      </span><span class="nt">to</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">blue</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy.networking.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AdminNetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">red-tenant</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40</span>
<span class="w">  </span><span class="nt">subject</span><span class="p">:</span>
<span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span>
<span class="w">      </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">red</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
<span class="w">      </span><span class="nt">from</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">red</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
<span class="w">      </span><span class="nt">to</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">red</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy.networking.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AdminNetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yellow-tenant</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40</span>
<span class="w">  </span><span class="nt">subject</span><span class="p">:</span>
<span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span>
<span class="w">      </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yellow</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
<span class="w">      </span><span class="nt">from</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yellow</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
<span class="w">      </span><span class="nt">to</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yellow</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy.networking.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AdminNetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">green-tenant</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40</span>
<span class="w">  </span><span class="nt">subject</span><span class="p">:</span>
<span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span>
<span class="w">      </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">green</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
<span class="w">      </span><span class="nt">from</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">green</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
<span class="w">      </span><span class="nt">to</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">green</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy.networking.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AdminNetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">multi-tenant-isolation</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">43</span>
<span class="w">  </span><span class="nt">subject</span><span class="p">:</span>
<span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span>
<span class="w">      </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="nv">tenant</span><span class="p p-Indicator">,</span><span class="nt"> operator</span><span class="p">:</span><span class="w"> </span><span class="nv">In</span><span class="p p-Indicator">,</span><span class="nt"> values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">red</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">blue</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">green</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">yellow</span><span class="p p-Indicator">]}</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deny</span>
<span class="w">      </span><span class="nt">from</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deny</span>
<span class="w">      </span><span class="nt">to</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div>
<p>A limitation of doing the above approach of creating
explicit <code>Allow</code> policies for inter-tenant communication
followed by explicit <code>Deny</code> is that you cannot have finer
grain controls for inter-tenant communication on a pod level.</p>
<p>So in that case a better way to achieve the same thing above
is to flip the posture and deny straight on each tenant
ANP. In this case you can have networkpolicies created within
the tenant yellow or blue that tells what can or cannot be allowed:</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy.networking.k8s.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AdminNetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yellow-tenant</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40</span>
<span class="w">  </span><span class="nt">subject</span><span class="p">:</span>
<span class="w">    </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span>
<span class="w">      </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tenant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yellow</span>
<span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deny</span>
<span class="w">      </span><span class="nt">from</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tenant</span>
<span class="w">            </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NotIn</span>
<span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yellow</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deny</span>
<span class="w">      </span><span class="nt">to</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">namespaces</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tenant</span>
<span class="w">            </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NotIn</span>
<span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yellow</span>
</code></pre></div>
In that case you don't need a 43 priority ANP.
However note that if you define it this way then each
address-set will contain ALL the pods to be excluded
on each tenant ANP which might be a big number causing
scale bottlenecks. So its better to have smaller
non-overlapping address-sets as much as possible.</p>
<p>In order to be able to express "allow-to-yourself"
and "deny-from-everyone-else" better, we have some ongoing
upstream design work where we hope to be able to condense
1 policy per tenant to be 1 policy for all tenants. Until
then unfortunately you'd need to create 1 policy per tenant
to achieve isolation.</p>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<p>In order to ensure the ANP and BANP are correctly created,
do <code>kubectl get anp</code> or <code>kubectl get banp</code> to see the status
of the CRs. A sample good status will look like this:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>Conditions:
<span class="w">    </span>Last<span class="w"> </span>Transition<span class="w"> </span>Time:<span class="w">  </span><span class="m">2024</span>-06-08T20:29:00Z
<span class="w">    </span>Message:<span class="w">               </span>Setting<span class="w"> </span>up<span class="w"> </span>OVN<span class="w"> </span>DB<span class="w"> </span>plumbing<span class="w"> </span>was<span class="w"> </span>successful
<span class="w">    </span>Reason:<span class="w">                </span>SetupSucceeded
<span class="w">    </span>Status:<span class="w">                </span>True
<span class="w">    </span>Type:<span class="w">                  </span>Ready-In-Zone-ovn-control-plane
<span class="w">    </span>Last<span class="w"> </span>Transition<span class="w"> </span>Time:<span class="w">  </span><span class="m">2024</span>-06-08T20:29:00Z
<span class="w">    </span>Message:<span class="w">               </span>Setting<span class="w"> </span>up<span class="w"> </span>OVN<span class="w"> </span>DB<span class="w"> </span>plumbing<span class="w"> </span>was<span class="w"> </span>successful
<span class="w">    </span>Reason:<span class="w">                </span>SetupSucceeded
<span class="w">    </span>Status:<span class="w">                </span>True
<span class="w">    </span>Type:<span class="w">                  </span>Ready-In-Zone-ovn-worker
<span class="w">    </span>Last<span class="w"> </span>Transition<span class="w"> </span>Time:<span class="w">  </span><span class="m">2024</span>-06-08T20:29:00Z
<span class="w">    </span>Message:<span class="w">               </span>Setting<span class="w"> </span>up<span class="w"> </span>OVN<span class="w"> </span>DB<span class="w"> </span>plumbing<span class="w"> </span>was<span class="w"> </span>successful
<span class="w">    </span>Reason:<span class="w">                </span>SetupSucceeded
<span class="w">    </span>Status:<span class="w">                </span>True
<span class="w">    </span>Type:<span class="w">                  </span>Ready-In-Zone-ovn-worker2
</code></pre></div>
<p>If the plumbing went wrong, you would see an error reported from
that respective zone controller on the status. Then the next step
is to check the logs of <code>ovnkube-controller</code> container on the
data plane side in the <code>ovnkube-node</code> pod.</p>
<h3 id="acl-logging">ACL Logging<a class="headerlink" href="#acl-logging" title="Permanent link">&para;</a></h3>
<p>ACL logging feature can be enabled on a per policy level. You can do</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>annotate<span class="w"> </span>anp<span class="w"> </span>cluster-control<span class="w"> </span>k8s.ovn.org/acl-logging<span class="o">=</span><span class="s1">&#39;{ &quot;deny&quot;: &quot;alert&quot;, &quot;allow&quot;: &quot;alert&quot;, &quot;pass&quot; : &quot;warning&quot; }&#39;</span>
</code></pre></div>
<p>to activate logging for the above admin network policy. In order to
ensure it was correctly applied you can do <code>kubectl describe anp cluster-control</code>:</p>
<div class="highlight"><pre><span></span><code>Name:<span class="w">         </span>cluster-control
Namespace:<span class="w">    </span>
Labels:<span class="w">       </span>&lt;none&gt;
Annotations:<span class="w">  </span>k8s.ovn.org/acl-logging:<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="s2">&quot;deny&quot;</span>:<span class="w"> </span><span class="s2">&quot;alert&quot;</span>,<span class="w"> </span><span class="s2">&quot;allow&quot;</span>:<span class="w"> </span><span class="s2">&quot;alert&quot;</span>,<span class="w"> </span><span class="s2">&quot;pass&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;warning&quot;</span><span class="w"> </span><span class="o">}</span>
API<span class="w"> </span>Version:<span class="w">  </span>policy.networking.k8s.io/v1alpha1
Kind:<span class="w">         </span>AdminNetworkPolicy
</code></pre></div>
<p>In order to view what's happening with the traffic that matches
this policy, you can do:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>ovn-kubernetes<span class="w"> </span>ovnkube-node-ggrxt<span class="w"> </span>ovn-controller<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>acl
</code></pre></div>
<p>and it will show you all the ACL logs logged by ovn-controller container.
Sample logging output:</p>
<div class="highlight"><pre><span></span><code><span class="m">2024</span>-06-09T19:00:10.441Z<span class="p">|</span><span class="m">00162</span><span class="p">|</span>acl_log<span class="o">(</span>ovn_pinctrl0<span class="o">)</span><span class="p">|</span>INFO<span class="p">|</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Egress:1&quot;</span>,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>allow,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">direction</span><span class="o">=</span>from-lport:<span class="w"> </span>tcp,vlan_tci<span class="o">=</span>0x0000,dl_src<span class="o">=</span>0a:58:0a:f4:02:06,dl_dst<span class="o">=</span>0a:58:0a:f4:02:01,nw_src<span class="o">=</span><span class="m">10</span>.244.2.6,nw_dst<span class="o">=</span><span class="m">172</span>.18.0.3,nw_tos<span class="o">=</span><span class="m">0</span>,nw_ecn<span class="o">=</span><span class="m">0</span>,nw_ttl<span class="o">=</span><span class="m">64</span>,nw_frag<span class="o">=</span>no,tp_src<span class="o">=</span><span class="m">33690</span>,tp_dst<span class="o">=</span><span class="m">6443</span>,tcp_flags<span class="o">=</span>ack
<span class="m">2024</span>-06-09T19:00:10.696Z<span class="p">|</span><span class="m">00163</span><span class="p">|</span>acl_log<span class="o">(</span>ovn_pinctrl0<span class="o">)</span><span class="p">|</span>INFO<span class="p">|</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Egress:1&quot;</span>,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>allow,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">direction</span><span class="o">=</span>from-lport:<span class="w"> </span>tcp,vlan_tci<span class="o">=</span>0x0000,dl_src<span class="o">=</span>0a:58:0a:f4:02:03,dl_dst<span class="o">=</span>0a:58:0a:f4:02:01,nw_src<span class="o">=</span><span class="m">10</span>.244.2.3,nw_dst<span class="o">=</span><span class="m">172</span>.18.0.3,nw_tos<span class="o">=</span><span class="m">0</span>,nw_ecn<span class="o">=</span><span class="m">0</span>,nw_ttl<span class="o">=</span><span class="m">64</span>,nw_frag<span class="o">=</span>no,tp_src<span class="o">=</span><span class="m">57658</span>,tp_dst<span class="o">=</span><span class="m">6443</span>,tcp_flags<span class="o">=</span>psh<span class="p">|</span>ack
<span class="m">2024</span>-06-09T19:00:10.698Z<span class="p">|</span><span class="m">00164</span><span class="p">|</span>acl_log<span class="o">(</span>ovn_pinctrl0<span class="o">)</span><span class="p">|</span>INFO<span class="p">|</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Egress:1&quot;</span>,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>allow,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">direction</span><span class="o">=</span>from-lport:<span class="w"> </span>tcp,vlan_tci<span class="o">=</span>0x0000,dl_src<span class="o">=</span>0a:58:0a:f4:02:03,dl_dst<span class="o">=</span>0a:58:0a:f4:02:01,nw_src<span class="o">=</span><span class="m">10</span>.244.2.3,nw_dst<span class="o">=</span><span class="m">172</span>.18.0.3,nw_tos<span class="o">=</span><span class="m">0</span>,nw_ecn<span class="o">=</span><span class="m">0</span>,nw_ttl<span class="o">=</span><span class="m">64</span>,nw_frag<span class="o">=</span>no,tp_src<span class="o">=</span><span class="m">57658</span>,tp_dst<span class="o">=</span><span class="m">6443</span>,tcp_flags<span class="o">=</span>ack
<span class="m">2024</span>-06-09T19:00:11.386Z<span class="p">|</span><span class="m">00165</span><span class="p">|</span>acl_log<span class="o">(</span>ovn_pinctrl0<span class="o">)</span><span class="p">|</span>INFO<span class="p">|</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Egress:5&quot;</span>,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>drop,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">direction</span><span class="o">=</span>from-lport:<span class="w"> </span>icmp,vlan_tci<span class="o">=</span>0x0000,dl_src<span class="o">=</span>0a:58:0a:f4:02:07,dl_dst<span class="o">=</span>0a:58:0a:f4:02:08,nw_src<span class="o">=</span><span class="m">10</span>.244.2.7,nw_dst<span class="o">=</span><span class="m">10</span>.244.2.8,nw_tos<span class="o">=</span><span class="m">0</span>,nw_ecn<span class="o">=</span><span class="m">0</span>,nw_ttl<span class="o">=</span><span class="m">64</span>,nw_frag<span class="o">=</span>no,icmp_type<span class="o">=</span><span class="m">8</span>,icmp_code<span class="o">=</span><span class="m">0</span>
</code></pre></div>
<p>The same is applicable to debug baseline admin network policy as well
except for the fact that there is no <code>pass</code> in BANP:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>annotate<span class="w"> </span>banp<span class="w"> </span>default<span class="w"> </span>k8s.ovn.org/acl-logging<span class="o">=</span><span class="s1">&#39;{ &quot;deny&quot;: &quot;alert&quot;, &quot;allow&quot;: &quot;alert&quot; }&#39;</span>
</code></pre></div>
<h3 id="ensuring-nbdb-objects-are-correctly-created">Ensuring NBDB objects are correctly created<a class="headerlink" href="#ensuring-nbdb-objects-are-correctly-created" title="Permanent link">&para;</a></h3>
<p>See the details outlined in the OVN constructs section on
what are the OVN database constructs created for ANPs and BANP
in a cluster. For example, in order to troubleshoot the
<code>cluster-control</code> ANP at priority 34, we can list the address-sets,
acls and port-group like shown in the above section. But
that will list all the acls, address-sets and port-groups
in your cluster also used by other features. To narrow it
down to the specific policy in question you can grep for
the name of the ANP you care about:</p>
<ul>
<li><code>ovn-nbctl list acl | grep cluster-control</code> (Do grep with -A, -B, -C to see the full ACL)</li>
<li><code>ovn-nbctl list address-set | grep anp-name</code></li>
<li><code>ovn-nbctl list port-group | grep anp-name</code></li>
</ul>
<p>An easier way to search for the relevant ACLs/AddressSets/PortGroups is:</p>
<ul>
<li><code>ovn-nbctl find ACL 'external_ids{&gt;=}{"k8s.ovn.org/owner-type"=AdminNetworkPolicy,"k8s.ovn.org/name"=cluster-control}'</code></li>
<li><code>ovn-nbctl find Address_Set 'external_ids{&gt;=}{"k8s.ovn.org/owner-type"=AdminNetworkPolicy,"k8s.ovn.org/name"=cluster-control}'</code></li>
<li><code>ovn-nbctl find Port_Group 'external_ids{&gt;=}{"k8s.ovn.org/owner-type"=AdminNetworkPolicy,"k8s.ovn.org/name"=cluster-control}'</code></li>
</ul>
<p>If you want to know the specific rule's ACLs you can use the gress-index field as well:</p>
<ul>
<li><code>ovn-nbctl find ACL 'external_ids{&gt;=}{"k8s.ovn.org/owner-type"=AdminNetworkPolicy,"k8s.ovn.org/name"=cluster-control,gress-index="5"}'</code></li>
<li><code>ovn-nbctl find Address_Set 'external_ids{&gt;=}{"k8s.ovn.org/owner-type"=AdminNetworkPolicy,"k8s.ovn.org/name"=cluster-control,gress-index="5"}'</code></li>
</ul>
<p>This will print out all the ACLs and address-sets and
portgroups owned by that ANP. In order to troubleshoot
a specific rule; example Rule5 <code>default-deny</code> in egress
of <code>cluster-control</code> ANP:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default-deny&quot;</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deny&quot;</span>
<span class="w">    </span><span class="nt">to</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
</code></pre></div>
<p>We can start with the knowledge that this rule must be
translated into one or more ACLs like mentioned in the
above section. Since there is no L4 match it should be
translated to a single ACL. Knowing the rule number, we
can grep for the correct ACL:</p>
<p><code>ovn-nbctl list acl | grep cluster-control:Egress:5</code></p>
<p>So <code>&lt;anpName&gt;:&lt;direction&gt;:&lt;ruleNumber&gt;</code> can be the grep
pattern to get the right ACL. For this rule it looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">sh-5.2# ovn-nbctl list acl | grep cluster-control:Egress:5 -C 4</span>

<span class="l l-Scalar l-Scalar-Plain">_uuid</span><span class="w">               </span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">924b81fd-65cc-494b-9c29-0c5287d69bb1</span>
<span class="nt">action              </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">drop</span>
<span class="nt">direction           </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">from-lport</span>
<span class="nt">external_ids        </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">direction=Egress</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">gress-index=&quot;5&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;k8s.ovn.org/id&quot;</span><span class="nv">=&quot;default-network-controller</span><span class="p p-Indicator">:</span><span class="nv">AdminNetworkPolicy</span><span class="p p-Indicator">:</span><span class="nv">cluster-control</span><span class="p p-Indicator">:</span><span class="nv">Egress</span><span class="p p-Indicator">:</span><span class="nv">5</span><span class="p p-Indicator">:</span><span class="nv">None&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;k8s.ovn.org/name&quot;</span><span class="nv">=cluster-control</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="nv">=default-network-controller</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;k8s.ovn.org/owner-type&quot;</span><span class="nv">=AdminNetworkPolicy</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">port-policy-protocol=None</span><span class="p p-Indicator">}</span>
<span class="nt">label               </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="nt">log                 </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">match               </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;inport</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">@a14645450421485494999</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">((ip4.dst</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">$a11452480169090787059))&quot;</span>
<span class="nt">meter               </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">acl-logging</span>
<span class="nt">name                </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ANP:cluster-control:Egress:5&quot;</span>
<span class="nt">options             </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">apply-after-lb=&quot;true&quot;</span><span class="p p-Indicator">}</span>
<span class="nt">priority            </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">26595</span>
<span class="nt">severity            </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">tier                </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</code></pre></div>
<p>The important part in an ACL is its <code>match</code> and <code>action</code>.
What this above rule says is that if a packet matches
the provided <code>match</code> then OVN takes the provided <code>action</code>.</p>
<p>Match here is: <code>"inport == @a14645450421485494999 &amp;&amp; ((ip4.dst == $a11452480169090787059))"</code></p>
<p>which makes no sense at face value. Let's dissect the
first part here <code>inport == @a14645450421485494999</code>.</p>
<p><code>inport</code> here refers to the port-group that this ACL is
attached to. So you can do:</p>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">sh-5.2# ovn-nbctl list port-group a14645450421485494999</span>

<span class="l l-Scalar l-Scalar-Plain">_uuid</span><span class="w">               </span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ff405445-be4f-4cde-8660-ee740c628f61</span>
<span class="nt">acls                </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">00400c05-7225-4d64-9428-8b2a04c6c3da</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">04dbde8f-eaa8-4973-a158-ec56d0be672f</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1b1b1409-b96a-4e6d-9776-00d88c0c7ac9</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2f3292f0-9676-4d02-a553-230c3a2885b8</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3e82df77-ad40-4dce-bd96-5b9e7e0b3603</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">4117970c-c138-45b5-a6de-8e5e54efcb04</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">7f5ea19b-d465-4de4-8369-bdf66fdcd7d9</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">8f1b8170-c350-4e9d-8ff0-a3177f9749ca</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">924b81fd-65cc-494b-9c29-0c5287d69bb1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">c37d0794-8444-440e-87d0-02ef95c6e248</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">f4523ce3-fb80-4d68-a50b-8aa6a795f895</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">fdb266b7-758a-4471-9cc1-84d00dc4f2ae</span><span class="p p-Indicator">]</span>
<span class="nt">external_ids        </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="s">&quot;k8s.ovn.org/id&quot;</span><span class="nv">=&quot;default-network-controller</span><span class="p p-Indicator">:</span><span class="nv">AdminNetworkPolicy</span><span class="p p-Indicator">:</span><span class="nv">cluster-control&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;k8s.ovn.org/name&quot;</span><span class="nv">=cluster-control</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="nv">=default-network-controller</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;k8s.ovn.org/owner-type&quot;</span><span class="nv">=AdminNetworkPolicy</span><span class="p p-Indicator">}</span>
<span class="nt">name                </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">a14645450421485494999</span>
<span class="nt">ports               </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">050c1f3d-fe1d-4d40-8f3a-9e21d09f0506</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">30b5ed88-005a-4c86-80bb-6850173dec4b</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">4f14f82b-2ec2-4b40-a6a7-7303105e45bb</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">6868266a-b06f-4660-a5b6-394c0dbaf16b</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">d3196102-853f-4c4a-af60-01b0047fc48b</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">f44a954f-3a57-4b62-ac89-5a4b55eebf5c</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>that shows you all the ports present in this port-group.
Each port in the list <code>ports</code> represents a pod that is
the subject of this policy.</p>
<p>You can do <code>ovn-nbctl list logical-switch-port &lt;uuid-port&gt;</code>
to know which pod is present.</p>
<p>Let's look into the second half of the match <code>ip4.dst == $a11452480169090787059</code>.</p>
<p>The destination must be an IP inside the address-set <code>a11452480169090787059</code>.
That's what it means:</p>
<div class="highlight"><pre><span></span><code><span class="nt">_uuid               </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c8b87fe8-dd6c-4ef3-8cea-e7ea8a5bdb3d</span>
<span class="nt">addresses           </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;0.0.0.0/0&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">external_ids        </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">direction=Egress</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">gress-index=&quot;5&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ip-family=v4</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;k8s.ovn.org/id&quot;</span><span class="nv">=&quot;default-network-controller</span><span class="p p-Indicator">:</span><span class="nv">AdminNetworkPolicy</span><span class="p p-Indicator">:</span><span class="nv">cluster-control</span><span class="p p-Indicator">:</span><span class="nv">Egress</span><span class="p p-Indicator">:</span><span class="nv">5</span><span class="p p-Indicator">:</span><span class="nv">v4&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;k8s.ovn.org/name&quot;</span><span class="nv">=cluster-control</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;k8s.ovn.org/owner-controller&quot;</span><span class="nv">=default-network-controller</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;k8s.ovn.org/owner-type&quot;</span><span class="nv">=AdminNetworkPolicy</span><span class="p p-Indicator">}</span>
<span class="nt">name                </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">a11452480169090787059</span>
</code></pre></div>
<p>Here you can see that <code>0.0.0.0/0</code> is the only IP in
the set but it means all IPs.</p>
<p>So now match makes more sense: Where we are saying
source of traffic shoule be the port of any one of these pods in the
port-group AND destination is any IP, then we <code>drop</code> the
packet which is the <code>action</code> on the ACL.</p>
<p>Using this method each policy rule can be debugged to
see if constructs at OVN level are created correctly.
An easier way is to simply run an
<a href="https://ovn-kubernetes.io/troubleshooting/ovnkube-trace/">ovnkube-trace</a>.</p>
<h3 id="ovn-tracing">OVN Tracing<a class="headerlink" href="#ovn-tracing" title="Permanent link">&para;</a></h3>
<p>You can do an <code>ovnkube-trace</code> or <code>ovn-trace</code> to figure out if the traffic is getting
blocked or allowed or passed correctly using OVN ACLs.</p>
<p>Sample tracing output for a pod in <code>restricted</code> namespace trying to ping
a pod in <code>monitoring</code> namespace can be seen here:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>rsh<span class="w"> </span>-n<span class="w"> </span>ovn-kubernetes<span class="w"> </span>ovnkube-node-ggrxt
Defaulted<span class="w"> </span>container<span class="w"> </span><span class="s2">&quot;nb-ovsdb&quot;</span><span class="w"> </span>out<span class="w"> </span>of:<span class="w"> </span>nb-ovsdb,<span class="w"> </span>sb-ovsdb,<span class="w"> </span>ovn-northd,<span class="w"> </span>ovnkube-controller,<span class="w"> </span>ovn-controller,<span class="w"> </span>ovs-metrics-exporter
sh-5.2#<span class="w"> </span>ovn-trace<span class="w"> </span>--ct<span class="w"> </span>new<span class="w"> </span><span class="s1">&#39;inport==&quot;restricted_restricted-65948898b-b2hhj&quot; &amp;&amp; eth.src==0a:58:0a:f4:02:07 &amp;&amp; eth.dst==0a:58:0a:f4:02:01 &amp;&amp; ip4.src==10.244.2.7 &amp;&amp; ip4.dst==10.244.2.8 &amp;&amp; icmp&#39;</span>
<span class="c1"># icmp,reg14=0x7,vlan_tci=0x0000,dl_src=0a:58:0a:f4:02:07,dl_dst=0a:58:0a:f4:02:01,nw_src=10.244.2.7,nw_dst=10.244.2.8,nw_tos=0,nw_ecn=0,nw_ttl=0,nw_frag=no,icmp_type=0,icmp_code=0</span>

ingress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;ovn-worker2&quot;</span>,<span class="w"> </span><span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;restricted_restricted-65948898b-b2hhj&quot;</span><span class="o">)</span>
-------------------------------------------------------------------------
<span class="w"> </span><span class="m">0</span>.<span class="w"> </span>ls_in_check_port_sec<span class="w"> </span><span class="o">(</span>northd.c:8691<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">50</span>,<span class="w"> </span>uuid<span class="w"> </span>a6855493
<span class="w">    </span>reg0<span class="o">[</span><span class="m">15</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>check_in_port_sec<span class="o">()</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">4</span>.<span class="w"> </span>ls_in_pre_acl<span class="w"> </span><span class="o">(</span>northd.c:5997<span class="o">)</span>:<span class="w"> </span>ip,<span class="w"> </span>priority<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>uuid<span class="w"> </span>ecaba77c
<span class="w">    </span>reg0<span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">5</span>.<span class="w"> </span>ls_in_pre_lb<span class="w"> </span><span class="o">(</span>northd.c:6203<span class="o">)</span>:<span class="w"> </span>ip,<span class="w"> </span>priority<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>uuid<span class="w"> </span>e37304d7
<span class="w">    </span>reg0<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">6</span>.<span class="w"> </span>ls_in_pre_stateful<span class="w"> </span><span class="o">(</span>northd.c:6231<span class="o">)</span>:<span class="w"> </span>reg0<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">110</span>,<span class="w"> </span>uuid<span class="w"> </span>cac1d984
<span class="w">    </span>ct_lb_mark<span class="p">;</span>

ct_lb_mark
----------
<span class="w"> </span><span class="m">7</span>.<span class="w"> </span>ls_in_acl_hint<span class="w"> </span><span class="o">(</span>northd.c:6297<span class="o">)</span>:<span class="w"> </span>ct.new<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!ct.est,<span class="w"> </span>priority<span class="w"> </span><span class="m">7</span>,<span class="w"> </span>uuid<span class="w"> </span>a5d96cbe
<span class="w">    </span>reg0<span class="o">[</span><span class="m">7</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>reg0<span class="o">[</span><span class="m">9</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">8</span>.<span class="w"> </span>ls_in_acl_eval<span class="w"> </span><span class="o">(</span>northd.c:6897<span class="o">)</span>:<span class="w"> </span>ip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!ct.est,<span class="w"> </span>priority<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>uuid<span class="w"> </span>cb01d163
<span class="w">    </span>reg0<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">9</span>.<span class="w"> </span>ls_in_acl_action<span class="w"> </span><span class="o">(</span>northd.c:6725<span class="o">)</span>:<span class="w"> </span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">500</span>,<span class="w"> </span>uuid<span class="w"> </span>a19ed2d6
<span class="w">    </span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="o">(</span><span class="m">8</span><span class="o">)</span><span class="p">;</span>
<span class="w"> </span><span class="m">8</span>.<span class="w"> </span>ls_in_acl_eval<span class="w"> </span><span class="o">(</span>northd.c:6897<span class="o">)</span>:<span class="w"> </span>ip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!ct.est,<span class="w"> </span>priority<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>uuid<span class="w"> </span>cb01d163
<span class="w">    </span>reg0<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">9</span>.<span class="w"> </span>ls_in_acl_action<span class="w"> </span><span class="o">(</span>northd.c:6725<span class="o">)</span>:<span class="w"> </span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">500</span>,<span class="w"> </span>uuid<span class="w"> </span>bf86b332
<span class="w">    </span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">;</span>
<span class="w">    </span>next<span class="o">(</span><span class="m">8</span><span class="o">)</span><span class="p">;</span>
<span class="w"> </span><span class="m">8</span>.<span class="w"> </span>ls_in_acl_eval<span class="w"> </span><span class="o">(</span>northd.c:6897<span class="o">)</span>:<span class="w"> </span>ip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!ct.est,<span class="w"> </span>priority<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>uuid<span class="w"> </span>cb01d163
<span class="w">    </span>reg0<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">9</span>.<span class="w"> </span>ls_in_acl_action<span class="w"> </span><span class="o">(</span>northd.c:6725<span class="o">)</span>:<span class="w"> </span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">500</span>,<span class="w"> </span>uuid<span class="w"> </span>674b033e
<span class="w">    </span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">;</span>
<span class="w">    </span>next<span class="o">(</span><span class="m">8</span><span class="o">)</span><span class="p">;</span>
<span class="w"> </span><span class="m">8</span>.<span class="w"> </span>ls_in_acl_eval<span class="w"> </span><span class="o">(</span>northd.c:6897<span class="o">)</span>:<span class="w"> </span>ip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!ct.est,<span class="w"> </span>priority<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>uuid<span class="w"> </span>cb01d163
<span class="w">    </span>reg0<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">9</span>.<span class="w"> </span>ls_in_acl_action<span class="w"> </span><span class="o">(</span>northd.c:6714<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>uuid<span class="w"> </span>7bea61b0
<span class="w">    </span>reg8<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>reg8<span class="o">[</span><span class="m">17</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>reg8<span class="o">[</span><span class="m">18</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">15</span>.<span class="w"> </span>ls_in_pre_hairpin<span class="w"> </span><span class="o">(</span>northd.c:7778<span class="o">)</span>:<span class="w"> </span>ip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ct.trk,<span class="w"> </span>priority<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>uuid<span class="w"> </span>39454be7
<span class="w">    </span>reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>chk_lb_hairpin<span class="o">()</span><span class="p">;</span>
<span class="w">    </span>reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>chk_lb_hairpin_reply<span class="o">()</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">19</span>.<span class="w"> </span>ls_in_acl_after_lb_action<span class="w"> </span><span class="o">(</span>northd.c:6725<span class="o">)</span>:<span class="w"> </span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">500</span>,<span class="w"> </span>uuid<span class="w"> </span>dbb2d69a
<span class="w">    </span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="o">(</span><span class="m">18</span><span class="o">)</span><span class="p">;</span>
<span class="m">18</span>.<span class="w"> </span>ls_in_acl_after_lb_eval<span class="w"> </span><span class="o">(</span>northd.c:6552<span class="o">)</span>:<span class="w"> </span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg0<span class="o">[</span><span class="m">9</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>@a14645450421485494999<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">((</span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">$a11452480169090787059</span><span class="o">)))</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">27595</span>,<span class="w"> </span>uuid<span class="w"> </span>369e6009
<span class="w">    </span>log<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ANP:cluster-control:Egress:5&quot;</span>,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>drop,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">meter</span><span class="o">=</span><span class="s2">&quot;acl-logging__924b81fd-65cc-494b-9c29-0c5287d69bb1&quot;</span><span class="o">)</span><span class="p">;</span>

<span class="w">    </span>LOG:<span class="w"> </span>ACL<span class="w"> </span><span class="nv">name</span><span class="o">=</span>ANP:cluster-control:Egress:5,<span class="w"> </span><span class="nv">direction</span><span class="o">=</span>IN,<span class="w"> </span><span class="nv">verdict</span><span class="o">=</span>drop,<span class="w"> </span><span class="nv">severity</span><span class="o">=</span>alert,<span class="w"> </span><span class="nv">packet</span><span class="o">=</span><span class="s2">&quot;ct_state=new|trk,icmp,reg0=0x287,reg8=0x40000000,reg14=0x7,vlan_tci=0x0000,dl_src=0a:58:0a:f4:02:07,dl_dst=0a:58:0a:f4:02:01,nw_src=10.244.2.7,nw_dst=10.244.2.8,nw_tos=0,nw_ecn=0,nw_ttl=0,nw_frag=no,icmp_type=0,icmp_code=0&quot;</span>
<span class="w">    </span>-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
<span class="w">    </span>reg8<span class="o">[</span><span class="m">17</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">19</span>.<span class="w"> </span>ls_in_acl_after_lb_action<span class="w"> </span><span class="o">(</span>northd.c:6691<span class="o">)</span>:<span class="w"> </span>reg8<span class="o">[</span><span class="m">17</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">1000</span>,<span class="w"> </span>uuid<span class="w"> </span>0cd7e938
<span class="w">    </span>reg8<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>reg8<span class="o">[</span><span class="m">17</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>reg8<span class="o">[</span><span class="m">18</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>reg8<span class="o">[</span><span class="m">30</span>..31<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
</code></pre></div>
<p>The ingress rule1 in <code>cluster-control</code> ANP which allows traffic from
monitoring to everywhere is only allowed at a specific port 7564.
So ICMP traffic is not allowed in any way and so we hit the
egress rule5 where traffic egressing from restricted namespace
to monitoring namespace is blocked.</p>
<h3 id="metrics">Metrics<a class="headerlink" href="#metrics" title="Permanent link">&para;</a></h3>
<p>In order to help end users know how this feature looks
like in their cluster and what are the OVN objects created, we have
added metrics for this feature. There is a metrics collector interface
added to the admin network policy controller that periodically checks
its caches and reports the type of ANP rules that are currently present
on the cluster. Similarly there is another go routine invoked from
metrics controller that periodically polls the libovsdb caches to
query the count of OVN database objects created by the admin network
policy controller. Let's look at the set of exposed metrics that can
help users understand what's happening in this feature.</p>
<ul>
<li><code>ovnkube_controller_admin_network_policies</code>: The total number of admin
  network policies in the cluster</li>
<li><code>ovnkube_controller_baseline_admin_network_policies</code>: The total number
  of baseline admin network policies in the cluster</li>
<li><code>ovnkube_controller_admin_network_policies_db_objects</code>: The total number
  of OVN NBDB objects (table_name) owned by AdminNetworkPolicy controller in
  the cluster. <code>table_name</code> label here can be either <code>ACL</code> or <code>Address_Set</code>.</li>
<li><code>ovnkube_controller_baseline_admin_network_policies_db_objects</code>: The total
  number of OVN NBDB objects (table_name) owned by BaselineAdminNetworkPolicy
  controller in the cluster. <code>table_name</code> label here can be either <code>ACL</code> or <code>Address_Set</code>.</li>
<li><code>ovnkube_controller_admin_network_policies_rules</code>: The total number of rules
  across all admin network policies in the cluster grouped by <code>direction</code> and <code>action</code>.
  <code>direction</code> can be either <code>Ingress</code> or <code>Egress</code> and <code>action</code> can be either
  <code>Pass</code> or <code>Allow</code> or <code>Deny</code>.</li>
<li><code>ovnkube_controller_baseline_admin_network_policies_rules</code>: The total number of rules
  across all baseline admin network policies in the cluster grouped by <code>direction</code> and <code>action</code>.
  <code>direction</code> can be either <code>Ingress</code> or <code>Egress</code> and <code>action</code> can be either
  <code>Allow</code> or <code>Deny</code>.</li>
</ul>
<p><img alt="anp-metrics-1" src="../../../images/anp-metrics-1.png" />
<img alt="anp-metrics-2" src="../../../images/anp-metrics-2.png" />
<img alt="anp-metrics-3" src="../../../images/anp-metrics-3.png" />
<img alt="anp-metrics-4" src="../../../images/anp-metrics-4.png" /></p>
<h2 id="best-practices-and-gotchas">Best Practices and Gotchas!<a class="headerlink" href="#best-practices-and-gotchas" title="Permanent link">&para;</a></h2>
<ul>
<li>Its better to create ANPs at separate priorities so that the precedence
  is well defined and if you are creating two ANPs at the same priority,
  then it is the responsibility of the end user to ensure the rules in
  those ANPs are not overlapping. If it overlaps then its not guaranteed
  which one will take effect.</li>
<li>Unlike ANPs BANP is a singleton object. So there can be only 1 <code>default</code>
  BANP in your cluster. Hence use this policy wisely as a wider default
  guardrail.</li>
<li>API semantics for admin network policies are very different from network
  policies. There is no implicit deny when you create the policy. You have to
  explicitly define what you need. Because of this it is not possible to
  completely isolate the pod from everything using admin network policies for
  ingress traffic. The only peers you can express for a <code>Deny</code> ingress rule are
  pods; so atmost only "DENY from all other pods" can be expressed as the best
  case default deny for ingress. In case of egress, one can deny to 0.0.0.0/0
  and it will act like a default deny to everything.</li>
<li>When using 0.0.0.0/0 to DENY everything, it is recommeded to be extra careful.
  If higher priority allow rules for essential traffic like towards DNS and
  KAPI-server are not defined before doing the default-deny, then you have the
  potential to lock up your entire cluster leaving it in a non-functional state.</li>
<li>Unlike network policies, admin network policies are cluster-scoped. So use the
  empty namespace selector with care because it will select ALL namespaces in your
  cluster including the infrastructure namespaces like kube-system and kapi-server
  or openshift-*. Best practice to secure your workloads is to use workload
  specific labels and then use that as the namespace selector instead. Using <code>{}</code>
  empty namespace selector has the potential to lock up your entire cluster leaving
  it in a non-functional state.</li>
<li>Cluster Admins should care about interoperability with NetworkPolicies if any are
  expected to be present in the cluster namespaces. In such cases the action <code>Pass</code>
  can be leveraged to indicate admin doesn't want to block the traffic so that network
  policies take effect. If you use <code>Allow</code> rules on admin level, then it will become
  impossible for you to let finer grain controls within a namespace policy take effect.
  So almost always <code>Deny</code> and <code>Pass</code> can get the job done unless you have specific
  requirements for a strong <code>Allow</code>.
  On the other hand, if you don't (plan to) have any network policies in your cluster
  you can just use <code>Allow</code> instead to indicate you don't want to block the traffic.</li>
<li>Since <code>0-100</code> is the supported priority range, it is always better when designing
  your admin policies to use a middle range like <code>30-70</code> by leaving some placeholder
  priorities before and after. Even in the middle range, be careful to leave gaps so
  that as your infrastructure requirements evolve over time, you are able to insert
  new ANPs when needed at the right priority level. If you pack your ANPs, then you
  might need to recreate all of them to accommodate any changes in the future.</li>
<li>Each rule can have upto 100 peers. All those peers are added to the same address-set.
  It is for the best if selectors across multiple rules don't overlap so that different
  address-sets don't have the same IPs in them. OVN has perf/scale limitations where
  it doesn't do incremental processing at ovn-controller level in such cases. So any pod
  level churn causes full processing of OVS flows. See <a href="https://issues.redhat.com/browse/OCPBUGS-31385">here</a>
  for more details.</li>
<li><code>networks</code> peer in egress rule is meant to select external destinations. It is recommended
  to use <code>namespaces</code> and <code>pods</code> peers to select in-cluster peers. Do not use <code>networks</code> for
  podIP level matching.</li>
<li>Currently in order to express multi-tenant isolation, you need to do 1 ANP per tenant.
  There is some future planned work upstream to make this easier for users. See multi tenant
  isolation section for more details.</li>
</ul>
<h2 id="known-limitations-and-design-choices-of-ovn-kubernetes-anp-implementation">Known Limitations and Design Choices of OVN-Kubernetes ANP Implementation<a class="headerlink" href="#known-limitations-and-design-choices-of-ovn-kubernetes-anp-implementation" title="Permanent link">&para;</a></h2>
<ul>
<li>Even if API supports upto 1000 as a value for <code>spec.priority</code>, <strong>in OVN-Kubernetes
  we only support upto 99 as a max value</strong>. This is because of known limitation
  in OVN level for <code>nbdb.ACL</code> priority field. See <a href="https://bugzilla.redhat.com/show_bug.cgi?id=2175752">this</a>
  for more details. However the number of admin policies in a cluster are usually expected
  to be of a maximum of say 30-50 and not more than that based on use cases for
  which this API was defined for. <strong>Thus supported priority values in
  OVN-Kubernetes are from 0 to 99</strong>. When user tries to create an ANP with priority
  greater than 99 an event <code>ANPWithUnsupportedPriority</code> will be emitted. The user has
  to manually update the priority field so that it get's created correctly. There are
  ways around the known OVN limitation where in OVN-Kubernetes we could dynamically
  allocate priorities to ACLs but that is subject to end user feedback on if support for
  more priorities is desired.</li>
<li>Using <code>namedPorts</code> is not very performant efficient since each name has to get
  evaluated against the <code>subject</code> and <code>peer</code> pod's container ports and podIPs. Use this with caution
  in larger clusters where you have many pods selected as subjects or peers for policies
  matching <code>namedPorts</code> and each of these matched pod has many containers.</li>
</ul>
<h2 id="known-limitations-and-design-choices-of-anp-api">Known Limitations and Design Choices of ANP API<a class="headerlink" href="#known-limitations-and-design-choices-of-anp-api" title="Permanent link">&para;</a></h2>
<ul>
<li>The <code>subject</code> of an admin network policy does NOT include support for
  <code>host-networked</code> pods.</li>
<li>The <code>namespaces</code> and <code>pods</code> peers in admin network policy does NOT include
  support for <code>host-networked</code> pods.</li>
<li><code>nodes</code> peer can be specified only from <code>egress</code> rule. There are no ingress use
  cases yet which is why this is not supported from <code>ingress</code> rule.</li>
<li><code>networks</code> peer can be specified only from <code>egress</code> rule. There are no ingress use
  cases yet which is why this is not supported from <code>ingress</code> rule.</li>
<li>Specifying <code>namedPorts</code> with <code>networks</code> peer is not supported.</li>
</ul>
<h2 id="future-items">Future Items<a class="headerlink" href="#future-items" title="Permanent link">&para;</a></h2>
<ul>
<li>Support for <a href="https://network-policy-api.sigs.k8s.io/npeps/npep-133-fqdn-egress-selector/">FQDN Peers</a></li>
<li>Support for <a href="https://network-policy-api.sigs.k8s.io/npeps/npep-122/">Easier Tenant Expressions</a></li>
</ul>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://www.redhat.com/en/blog/using-adminnetworkpolicy-api-to-secure-openshift-cluster-networking">AdminNetworkPolicy on OpenShift</a></li>
<li><a href="https://github.com/kubernetes/enhancements/tree/master/keps/sig-network/2091-admin-network-policy#design-details">Kubernetes Enhancement Proposal</a></li>
<li><a href="https://network-policy-api.sigs.k8s.io/enhancements/">Network Policy Enhancement Proposals</a></li>
<li><a href="https://network-policy-api.sigs.k8s.io/reference/spec/">Kubernetes AdminNetworkPolicy API reference</a></li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright  OVN-Kubernetes a Series of LF Projects, LLC. For website terms of use, trademark policy and other project policies please see <a href="https://lfprojects.org/policies/">LF Projects Policies</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.indexes", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "content.code.copy", "content.code.annotate", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../javascripts/gemini-api-key.js"></script>
      
        <script src="../../../javascripts/theme.js"></script>
      
        <script src="../../../javascripts/extra.js"></script>
      
    
  </body>
</html>