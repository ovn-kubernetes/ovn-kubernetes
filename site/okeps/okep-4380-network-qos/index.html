
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://www.ovn.org/ovn-kubernetes/okeps/okep-4380-network-qos/">
      
      
        <link rel="prev" href="../okep-5085-localnet-api/">
      
      
        <link rel="next" href="../okep-5193-user-defined-networks/">
      
      
        
      
      
      <link rel="icon" href="../../images/ovn-inside-k8s.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Network QoS - OVN-Kubernetes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#okep-4380-network-qos-support" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OVN-Kubernetes" class="md-header__button md-logo" aria-label="OVN-Kubernetes" data-md-component="logo">
      
  <img src="../../images/ovn-inside-k8s.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OVN-Kubernetes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Network QoS
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Blueprint"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Blueprint" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.5 3A5.5 5.5 0 0 1 14 8.5c0 1.33-.47 2.55-1.26 3.5H21v9h-9v-8.26c-.95.79-2.17 1.26-3.5 1.26A5.5 5.5 0 0 1 3 8.5 5.5 5.5 0 0 1 8.5 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent="purple"  aria-label="Nerve Center"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Nerve Center" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19.07 4.93-1.41 1.41A8.01 8.01 0 0 1 20 12a8 8 0 0 1-8 8 8 8 0 0 1-8-8c0-4.08 3.05-7.44 7-7.93v2.02C8.16 6.57 6 9.03 6 12a6 6 0 0 0 6 6 6 6 0 0 0 6-6c0-1.66-.67-3.16-1.76-4.24l-1.41 1.41C15.55 9.9 16 10.9 16 12a4 4 0 0 1-4 4 4 4 0 0 1-4-4c0-1.86 1.28-3.41 3-3.86v2.14c-.6.35-1 .98-1 1.72a2 2 0 0 0 2 2 2 2 0 0 0 2-2c0-.74-.4-1.38-1-1.72V2h-1A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-2.76-1.12-5.26-2.93-7.07"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ovn-org/ovn-kubernetes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ovn-org/ovn-kubernetes
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
    
  
  Overview

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../installation/launching-ovn-kubernetes-on-kind/" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../governance/CONTRIBUTING/" class="md-tabs__link">
          
  
  
    
  
  Developer Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api-reference/introduction/" class="md-tabs__link">
          
  
  
    
  
  API Reference Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../features/user-defined-networks/user-defined-networks/" class="md-tabs__link">
          
  
  
    
  
  Features

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../troubleshooting/debugging/" class="md-tabs__link">
          
  
  
    
  
  Troubleshooting

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../observability/metrics/" class="md-tabs__link">
          
  
  
    
  
  Observability

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../okep-5085-localnet-api/" class="md-tabs__link">
          
  
  
    
  
  Enhancement Proposals

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../blog/" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OVN-Kubernetes" class="md-nav__button md-logo" aria-label="OVN-Kubernetes" data-md-component="logo">
      
  <img src="../../images/ovn-inside-k8s.png" alt="logo">

    </a>
    OVN-Kubernetes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ovn-org/ovn-kubernetes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ovn-org/ovn-kubernetes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/topology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Topology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/gateway-modes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gateway Modes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/traffic-flows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Traffic Flows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/pod-creation-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pod Creation Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/service-creation-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Service Creation Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/service-traffic-policy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Service Traffic Policy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/host-to-node-port-hairpin-trafficflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Host To NodePort Hairpin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/external-ip-and-loadbalancer-ingress/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ExternalIPs/LoadBalancerIngress
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../design/ovn-kubernetes-subnets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Internal Subnets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/live-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubevirt VM Live Migration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/launching-ovn-kubernetes-on-kind/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Launching OVN-Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/launching-ovn-kubernetes-with-helm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Launching OVN-Kubernetes Using Helm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/cli-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/example-pod-creation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deploying Workloads on OVN-Kubernetes cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/example-service-creation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deploying Services on OVN-Kubernetes cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/building-ovn-kubernetes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup and Building
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Developer Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Developer Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../governance/CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../governance/REVIEWING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reviewing Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/developer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coding Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/image-build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OVN-Kubernetes Container Images
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/local_testing_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local Testing Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ci/ci/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CI Testing Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer-guide/release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Release Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/egress-ip-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressIP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/egress-service-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressService
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/egress-qos-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressQoS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/egress-firewall-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressFirewall
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/admin-epbr-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AdminPolicyBasedExternalRoutes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/userdefinednetwork-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UserDefinedNetwork
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api-reference/routeadvertisements-api-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RouteAdvertisements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Universal Connectivity
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Universal Connectivity
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/user-defined-networks/user-defined-networks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UserDefinedNetwork
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    NetworkSecurityControls
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    NetworkSecurityControls
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/network-security-controls/admin-network-policy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AdminNetworkPolicy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/network-security-controls/network-policy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NetworkPolicy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/network-security-controls/egress-firewall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressFirewall
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ClusterEgressControls
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    ClusterEgressControls
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/cluster-egress-controls/egress-ip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressIP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/cluster-egress-controls/egress-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressService
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/cluster-egress-controls/egress-qos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressQoS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/cluster-egress-controls/egress-gateway/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EgressGateway
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    InfrastructureSecurityControls
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    InfrastructureSecurityControls
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/infrastructure-security-controls/node-identity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NodeIdentity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    MultiNetworking
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    MultiNetworking
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/multiple-networks/multi-homing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multihoming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/multiple-networks/multi-network-policies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MultiNetworkPolicies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/multiple-networks/multi-vtep/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MultiNetworkRails
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/multicast/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multicast
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    NetworkQoS
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    NetworkQoS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/network-qos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/network-qos-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Usage Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/live-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubevirt VM Live Migration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/hybrid-overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HybridOverlay
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_10" >
        
          
          <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Hardware Acceleration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Hardware Acceleration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/hardware-offload/ovs-kernel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OVS Acceleration with kernel datapath
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/hardware-offload/ovs-doca/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OVS Acceleration with DOCA datapath
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_11" >
        
          
          <label class="md-nav__link" for="__nav_5_11" id="__nav_5_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    BGP Integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    BGP Integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/bgp-integration/route-advertisements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Route Advertisements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Troubleshooting
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/ovnkube-trace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OVNKube Trace
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Observability
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Observability
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../observability/metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Metrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../observability/sdn-dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SDN Dashboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../observability/ovn-observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OVN observability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Enhancement Proposals
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Enhancement Proposals
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../okep-5085-localnet-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Localnet API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Network QoS
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Network QoS
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#problem-statement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Problem Statement
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#goals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Goals
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-goals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Non-Goals
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-storiesuse-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        User-Stories/Use-Cases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User-Stories/Use-Cases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#story-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Story 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#story-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Story 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#story-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Story 3
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proposed-solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proposed Solution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Proposed Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Details
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Details
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Details
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#documentation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Documentation Details
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#risks-known-limitations-and-mitigations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Risks, Known Limitations and Mitigations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ovn-kubernetes-version-skew" class="md-nav__link">
    <span class="md-ellipsis">
      
        OVN-Kubernetes Version Skew
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternatives" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alternatives
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../okep-5193-user-defined-networks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    User Defined Networks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../okep-5233-preconfigured-udn-addresses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Preconfigured UDN Addresses
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../okep-5296-bgp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BGP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../okep-5094-layer2-transit-router/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Layer2TransitRouter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../okep-5494-ovn-kubernetes-mcp-server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP for Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../okep-5552-dynamic-udn-node-allocation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dynamic UDN Node Allocation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../okep-5224-connecting-udns/okep-5224-connecting-udns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connecting User Defined Networks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../okep-5259-no-overlay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    No-Overlay Mode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../okep-5088-evpn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    EVPN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../okep-5674-dpu-healthcheck/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DPU Healthcheck
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../blog/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#problem-statement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Problem Statement
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#goals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Goals
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-goals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Non-Goals
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-storiesuse-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        User-Stories/Use-Cases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User-Stories/Use-Cases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#story-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Story 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#story-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Story 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#story-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Story 3
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proposed-solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Proposed Solution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Proposed Solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Details
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Details
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Details
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#documentation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Documentation Details
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#risks-known-limitations-and-mitigations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Risks, Known Limitations and Mitigations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ovn-kubernetes-version-skew" class="md-nav__link">
    <span class="md-ellipsis">
      
        OVN-Kubernetes Version Skew
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternatives" class="md-nav__link">
    <span class="md-ellipsis">
      
        Alternatives
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                




              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="okep-4380-network-qos-support">OKEP-4380: Network QoS Support<a class="headerlink" href="#okep-4380-network-qos-support" title="Permanent link">&para;</a></h1>
<ul>
<li>Issue: <a href="https://github.com/ovn-org/ovn-kubernetes/issues/4380">#4380</a></li>
</ul>
<h2 id="problem-statement">Problem Statement<a class="headerlink" href="#problem-statement" title="Permanent link">&para;</a></h2>
<p>The workloads running in Kubernetes, using OVN-Kubernetes (OVN-K8s) as a network plugin, might have
requirements in how their network traffic must be handled/differentiated compared to other workloads
within the same namespace or different namespaces. For example video streaming application needs low
latency and jitter whereas storage applications can tolerate packet loss. Hence, enforcing fair
share use of NIC's bandwidth on a K8s Node is essential in meeting these SLAs to provide better<br />
service quality.</p>
<p>Furthermore, some services in-zone (Physical Gateway to Internet) or in-cluster (Internet Gateway Pods)
would like to identify network traffic to provide differentiated services. To achieve this, it is
necessary to mark packets on the wire, enabling these services to apply differential treatment.  OVN natively
supports DSCP (Differentiated Services Code Point), 6-bit field in IP header, marking on IP
packets based on arbitrary match criteria for a logical switch.</p>
<h2 id="goals">Goals<a class="headerlink" href="#goals" title="Permanent link">&para;</a></h2>
<ol>
<li>Provide a mechanism for users to set DSCP marking on egress east/west (pod to pod overlay)<br />
   traffic and egress north/south (pod to external underlay) traffic.</li>
<li>Provide a mechanism for users to set Metering on egress east/west and egress north/south
   traffic on the NIC on the K8s Node.</li>
<li>Provide above mechanisms on all networks attached to K8s Pods.</li>
</ol>
<h2 id="non-goals">Non-Goals<a class="headerlink" href="#non-goals" title="Permanent link">&para;</a></h2>
<ol>
<li>Ingress Network QoS.</li>
<li>Consolidating with current <code>kubernetes.io/egress-bandwidth</code> and <code>kubernetes.io/ingress-bandwidth</code>
   annotations. Nonetheless, the work done here does not interfere with the current bandwidth  <br />
   enforcement mechanisms.</li>
<li>How the DSCP marking is handled by the physical network fabric is out-of-scope. It could be that
   the fabric could completely ignore the marking.</li>
</ol>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>There are several techniques to ensure Quality of Service (QoS) for workloads running in a
Kubernetes (K8s) cluster. One method involves traffic policing or metering, where traffic is
regulated on the NIC based on a configured rate and burst limit. Any traffic exceeding the limit is
dropped. This metering capability is natively supported by OVN through OVS Meters. Another method is
traffic shaping, where excess traffic is buffered and transmitted later when bandwidth becomes
available, at the cost of higher latency. However, this traffic shaping technique is not supported
by OVN and, consequently, cannot be implemented in the OVN-K8s Network plugin. Since network<br />
virtualization in OVN occurs on the K8s node (also known as the OVN chassis), bandwidth
enforcement for matched traffic occurs on the node itself. This allows OVN-K8s to provide API to
regulate NIC's bandwidth between the workloads running on the same or different namespaces
within a K8s node, even before the traffic reaches network fabric through the overlay.
Additionally, the network fabric can do its own regulation of network bandwidth, however how it
is done is outside the scope of this proposal.</p>
<p>Another strategy for providing differential treatment to workload network traffic involves marking
packets using DSCP (a 6-bit field in the IP header). These marked packets can then be handled
differently by in-zone and in-cluster services. OVN supports this packet marking capability through
OVS, allowing traffic to be classified based on specific match criteria. OVN marks the inner
packet's IP header. So, the marking appears inside the GENEVE tunnel. There are ways to transfer
this marking to outer header and influence how the underlay network fabric should handle such
packets, however that is outside the scope of this proposal.</p>
<p>Kubernetes offers partial support for QoS features through annotations such
as <code>kubernetes.io/egress-bandwidth</code> and <code>kubernetes.io/ingress-bandwidth</code> at the Pod interface
level. However, these annotations lack fine-grained control, as they cannot target specific types of
traffic (e.g., video streaming) on an interface. The Network Plumbing Working Group (NPWG) has
extended these annotations to secondary networks, but they remain limited to interface-level
configurations without options for selecting a particular traffic flow. Additionally, Kubernetes
currently lacks an API for DSCP packet marking.</p>
<p>To address these limitations, this proposal introduces a NetworkQoS API that enables fine-grained
bandwidth enforcement and packet marking across all interfaces within a Pod.</p>
<p>The proposed solution works out-of-the box for the case where a node belongs to a single tenant and
the tenant's namespace admin sets the NetworkQos for all the Pods landing on that Node. Say, a node
is shared by more than one tenant (not a common scenario) and two tenant namespace admins compete with
each other on setting the egress bandwidth limit. In this case, the K8s provider will have to resort
to AdmissionWebhooks to either restrict the values that the tenant namespace admin can use or inject
a default NetworkQos object in the respective namespaces with predefined values.</p>
<h2 id="user-storiesuse-cases">User-Stories/Use-Cases<a class="headerlink" href="#user-storiesuse-cases" title="Permanent link">&para;</a></h2>
<h4 id="story-1">Story 1<a class="headerlink" href="#story-1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>+---------------------+                                                                                                    
|NS1/Pod1 (paid user) +--DSCP:20                                                                                           
+---------------------+     |         .-----.----------------------------.-----.    +--------------------+      .-------.  
                            +------&gt; ;       :     Overlay Traffic      ;       :   |NS3/Internet Gateway|     /         \ 
                                     :       ;  Various DSCP marking    :       ---&gt;|   Forward + SNAT   +---&gt;( Internet  )
                         DSCP:11---&gt;  \     /                            \     /    |    to Underlay     |     `.       ,&#39; 
+---------------------+     |          `---&#39;------------------------------`---&#39;     +--------------------+       `-----&#39;   
|NS1/Pod2 (free user) +-----+                   .-------------------.                                                      
+---------------------+                   _.---&#39;                     `----.                                                
                                         /        Physical Underlay        \                                               
                                        (     (unaware of DSCP marking)     )                                              
                                         `.                               ,&#39;                                               
                                           `----.                   _.---&#39;                                                 
                                                 `-----------------&#39;                                                                                                                                                    
</code></pre></div>
<p>As a K8s Namespace Admin, I want to configure DSCP marking for egress east-west overlay traffic so that the
packet marking is carried from the source overlay pod to destination overlay pod, so that on the destination pod can
treat the incoming traffic differently.</p>
<p>For example: In the diagram above, Say Pod1 is a paid cloud gaming user and Pod2 is a free cloud gaming user.  I want
these two Pods to be treated differently by the InternetGateway application Pod. The packets leaving Pods Pod1 and Pod2
will be marked with DSCP value of 20 and 11 respectively. This marking will be retained on the overlay across the
fabric and arrive at the InternetGateway pod where the packets from the free user will be subjected queueing during peak times as
compared to the paid user who will not be subjected to any sort of queueing.</p>
<p>The namespace admin have the flexibility to define how they utilize the 6-bit DSCP field to meet their specific needs
for client/server traffic. They own both the client and server applications.</p>
<p>The end user is an individual who wants to play games in the cloud. The individual is a consumer of gaming services.</p>
<h4 id="story-2">Story 2<a class="headerlink" href="#story-2" title="Permanent link">&para;</a></h4>
<p>As a K8s Namespace Admin, I want to enforce egress bandwidth limit (rate and burst) on the east/west and north/south
traffic emanating from the Pods on the same K8s node so that they use the underlying NIC fairly.</p>
<p>In the same diagram above, I want to limit the egress bandwidth from Pod2 where a free-user is present to not exceed
1Mbps rate and 1Mbps burst. However, the paid-user might not have any such limitations.</p>
<h4 id="story-3">Story 3<a class="headerlink" href="#story-3" title="Permanent link">&para;</a></h4>
<p>As a K8s Namespace Admin, I want to define a catch-all NetworkQoS for all my Pods, and then have a more specific
NetworkQos for few Pods. As such, I need priorities to define this.</p>
<p>In the above diagram, I want all the Internet bound traffic from NS1/Pod1 and NS1/Pod2 to be bandwidth limited to
10Mbps. However, from the same set of Pods I want all the AWS S3 related traffic to be bandwidth limited to 100Mbps.</p>
<p>So, the namespace admin can create a catch-all NetworkQoS at priority 1 for all the Pods in NS1 heading
towards the Internet and create another NetworkQos at priority 2 to increase the egress bandwidth limit to AWS S3 IPs.</p>
<h2 id="proposed-solution">Proposed Solution<a class="headerlink" href="#proposed-solution" title="Permanent link">&para;</a></h2>
<p>The current EgressQoS is a namespace-scoped feature that enables DSCP marking for pod's egress
traffic directed towards dstCIDR. A namespace supports only one EgressQoS resource, named default
(any additional EgressQoS resources will be ignored). This enhancement proposes a replacement for
EgressQoS. By introducing a new CRD <code>NetworkQoS</code>, users could specify a DSCP value for packets<br />
originating from pods on a given namespace heading to a specified Namespace Selector, Pod
Selector, CIDR, Protocol and Port. This also supports metering for the packets by specifying<br />
bandwidth parameters <code>rate</code> and/or <code>burst</code>. The <code>priority</code> field enables one to define overlapping
rules such that the rule with higher priority (match could be generic) will override the rule
with lower priority (match will be specific. See: Story-3).</p>
<p>The CRD will be Namespaced, with multiple resources
allowed per namespace. The resources will be watched by OVN-K8s, which in turn will configure
OVN's <a href="https://man7.org/linux/man-pages/man5/ovn-nb.5.html#NetworkQoS_TABLE">QoS Table</a>. The<br />
<code>NetworkQoS</code> also has <code>status</code> field which is populated by OVN-K8s which helps users to identify
whether NetworkQoS rules are configured correctly in OVN or not.</p>
<h3 id="api-details">API Details<a class="headerlink" href="#api-details" title="Permanent link">&para;</a></h3>
<ul>
<li>A new API <code>NetworkQoS</code> under the <code>k8s.ovn.org/v1alpha1</code> group will be added to<br />
<code>go-controller/pkg/crd/networkqos/v1alpha1</code>. This would be a namespace-scoped CRD:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">networkingv1</span><span class="w"> </span><span class="s">&quot;k8s.io/api/networking/v1&quot;</span>
<span class="w">    </span><span class="nx">metav1</span><span class="w"> </span><span class="s">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>

<span class="w">    </span><span class="nx">crdtypes</span><span class="w"> </span><span class="s">&quot;github.com/ovn-org/ovn-kubernetes/go-controller/pkg/crd/types&quot;</span>
<span class="p">)</span>

<span class="c1">// +genclient</span>
<span class="c1">// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object</span>
<span class="c1">// +kubebuilder:resource:path=networkqoses</span>
<span class="c1">// +kubebuilder::singular=networkqos</span>
<span class="c1">// +kubebuilder:object:root=true</span>
<span class="c1">// +kubebuilder:printcolumn:name=&quot;Status&quot;,type=string,JSONPath=&quot;.status.status&quot;</span>
<span class="c1">// +kubebuilder:subresource:status</span>
<span class="c1">// NetworkQoS is a CRD that allows the user to define a DSCP marking and metering</span>
<span class="c1">// for pods ingress/egress traffic on its namespace to specified CIDRs,</span>
<span class="c1">// protocol and port. Traffic belong these pods will be checked against</span>
<span class="c1">// each Rule in the namespace&#39;s NetworkQoS, and if there is a match the traffic</span>
<span class="c1">// is marked with relevant DSCP value and enforcing specified policing</span>
<span class="c1">// parameters.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">NetworkQoS</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">metav1</span><span class="p">.</span><span class="nx">TypeMeta</span><span class="w">   </span><span class="s">`json:&quot;,inline&quot;`</span>
<span class="w">    </span><span class="nx">metav1</span><span class="p">.</span><span class="nx">ObjectMeta</span><span class="w"> </span><span class="s">`json:&quot;metadata,omitempty&quot;`</span>

<span class="w">    </span><span class="nx">Spec</span><span class="w">   </span><span class="nx">Spec</span><span class="w">   </span><span class="s">`json:&quot;spec,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Status</span><span class="w"> </span><span class="nx">Status</span><span class="w"> </span><span class="s">`json:&quot;status,omitempty&quot;`</span>
<span class="p">}</span>

<span class="c1">// Spec defines the desired state of NetworkQoS</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Spec</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// networkSelector selects the networks on which the pod IPs need to be added to the source address set.</span>
<span class="w">    </span><span class="c1">// NetworkQoS controller currently supports `NetworkAttachmentDefinitions` type only.</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:XValidation:rule=&quot;self == oldSelf&quot;, message=&quot;networkSelector is immutable&quot;</span>
<span class="w">    </span><span class="nx">NetworkSelectors</span><span class="w"> </span><span class="nx">crdtypes</span><span class="p">.</span><span class="nx">NetworkSelectors</span><span class="w"> </span><span class="s">`json:&quot;networkSelectors,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// podSelector applies the NetworkQoS rule only to the pods in the namespace whose label</span>
<span class="w">    </span><span class="c1">// matches this definition. This field is optional, and in case it is not set</span>
<span class="w">    </span><span class="c1">// results in the rule being applied to all pods in the namespace.</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">PodSelector</span><span class="w"> </span><span class="nx">metav1</span><span class="p">.</span><span class="nx">LabelSelector</span><span class="w"> </span><span class="s">`json:&quot;podSelector,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// priority is a value from 0 to 100 and represents the NetworkQoS&#39; priority.</span>
<span class="w">    </span><span class="c1">// QoSes with numerically higher priority takes precedence over those with lower.</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:Maximum:=100</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:Minimum:=0</span>
<span class="w">    </span><span class="nx">Priority</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="s">`json:&quot;priority&quot;`</span>

<span class="w">    </span><span class="c1">// egress a collection of Egress NetworkQoS rule objects. A total of 20 rules will</span>
<span class="w">    </span><span class="c1">// be allowed in each NetworkQoS instance. The relative precedence of egress rules</span>
<span class="w">    </span><span class="c1">// within a single NetworkQos object (all of which share the priority) will be</span>
<span class="w">    </span><span class="c1">// determined by the order in which the rule is written. Thus, a rule that appears</span>
<span class="w">    </span><span class="c1">// first in the list of egress rules would take the lower precedence.</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:MaxItems=20</span>
<span class="w">    </span><span class="nx">Egress</span><span class="w"> </span><span class="p">[]</span><span class="nx">Rule</span><span class="w"> </span><span class="s">`json:&quot;egress&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Rule</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// dscp marking value for matching pods&#39; traffic.</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:Maximum:=63</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:Minimum:=0</span>
<span class="w">    </span><span class="nx">DSCP</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="s">`json:&quot;dscp&quot;`</span>

<span class="w">    </span><span class="c1">// classifier The classifier on which packets should match</span>
<span class="w">    </span><span class="c1">// to apply the NetworkQoS Rule.</span>
<span class="w">    </span><span class="c1">// This field is optional, and in case it is not set the rule is applied</span>
<span class="w">    </span><span class="c1">// to all egress traffic regardless of the destination.</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">Classifier</span><span class="w"> </span><span class="nx">Classifier</span><span class="w"> </span><span class="s">`json:&quot;classifier&quot;`</span>

<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">Bandwidth</span><span class="w"> </span><span class="nx">Bandwidth</span><span class="w"> </span><span class="s">`json:&quot;bandwidth&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Classifier</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">To</span><span class="w"> </span><span class="p">[]</span><span class="nx">Destination</span><span class="w"> </span><span class="s">`json:&quot;to&quot;`</span>

<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">Ports</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Port</span><span class="w"> </span><span class="s">`json:&quot;ports&quot;`</span>
<span class="p">}</span>

<span class="c1">// Bandwidth controls the maximum of rate traffic that can be sent</span>
<span class="c1">// or received on the matching packets.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Bandwidth</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// rate The value of rate limit in kbps. Traffic over the limit</span>
<span class="w">    </span><span class="c1">// will be dropped.</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:Minimum:=1</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:Maximum:=4294967295</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">Rate</span><span class="w"> </span><span class="kt">uint32</span><span class="w"> </span><span class="s">`json:&quot;rate&quot;`</span>

<span class="w">    </span><span class="c1">// burst The value of burst rate limit in kilobits.</span>
<span class="w">    </span><span class="c1">// This also needs rate to be specified.</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:Minimum:=1</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:Maximum:=4294967295</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">Burst</span><span class="w"> </span><span class="kt">uint32</span><span class="w"> </span><span class="s">`json:&quot;burst&quot;`</span>
<span class="p">}</span>

<span class="c1">// Port specifies destination protocol and port on which NetworkQoS</span>
<span class="c1">// rule is applied</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Port</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// protocol (tcp, udp, sctp) that the traffic must match.</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:Pattern=^TCP|UDP|SCTP$</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">Protocol</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;protocol&quot;`</span>

<span class="w">    </span><span class="c1">// port that the traffic must match</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:Minimum:=1</span>
<span class="w">    </span><span class="c1">// +kubebuilder:validation:Maximum:=65535</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">Port</span><span class="w"> </span><span class="o">*</span><span class="kt">int32</span><span class="w"> </span><span class="s">`json:&quot;port&quot;`</span>
<span class="p">}</span>

<span class="c1">// Destination describes a peer to apply NetworkQoS configuration for the outgoing traffic.</span>
<span class="c1">// Only certain combinations of fields are allowed.</span>
<span class="c1">// +kubebuilder:validation:XValidation:rule=&quot;!(has(self.ipBlock) &amp;&amp; (has(self.podSelector) || has(self.namespaceSelector)))&quot;,message=&quot;Can&#39;t specify both podSelector/namespaceSelector and ipBlock&quot;</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Destination</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// podSelector is a label selector which selects pods. This field follows standard label</span>
<span class="w">    </span><span class="c1">// selector semantics; if present but empty, it selects all pods.</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// If namespaceSelector is also set, then the NetworkQoS as a whole selects</span>
<span class="w">    </span><span class="c1">// the pods matching podSelector in the Namespaces selected by NamespaceSelector.</span>
<span class="w">    </span><span class="c1">// Otherwise it selects the pods matching podSelector in the NetworkQoS&#39;s own namespace.</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">PodSelector</span><span class="w"> </span><span class="o">*</span><span class="nx">metav1</span><span class="p">.</span><span class="nx">LabelSelector</span><span class="w"> </span><span class="s">`json:&quot;podSelector,omitempty&quot; protobuf:&quot;bytes,1,opt,name=podSelector&quot;`</span>

<span class="w">    </span><span class="c1">// namespaceSelector selects namespaces using cluster-scoped labels. This field follows</span>
<span class="w">    </span><span class="c1">// standard label selector semantics; if present but empty, it selects all namespaces.</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// If podSelector is also set, then the NetworkQoS as a whole selects</span>
<span class="w">    </span><span class="c1">// the pods matching podSelector in the namespaces selected by namespaceSelector.</span>
<span class="w">    </span><span class="c1">// Otherwise it selects all pods in the namespaces selected by namespaceSelector.</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">NamespaceSelector</span><span class="w"> </span><span class="o">*</span><span class="nx">metav1</span><span class="p">.</span><span class="nx">LabelSelector</span><span class="w"> </span><span class="s">`json:&quot;namespaceSelector,omitempty&quot; protobuf:&quot;bytes,2,opt,name=namespaceSelector&quot;`</span>

<span class="w">    </span><span class="c1">// ipBlock defines policy on a particular IPBlock. If this field is set then</span>
<span class="w">    </span><span class="c1">// neither of the other fields can be.</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">IPBlock</span><span class="w"> </span><span class="o">*</span><span class="nx">networkingv1</span><span class="p">.</span><span class="nx">IPBlock</span><span class="w"> </span><span class="s">`json:&quot;ipBlock,omitempty&quot; protobuf:&quot;bytes,3,rep,name=ipBlock&quot;`</span>
<span class="p">}</span>

<span class="c1">// Status defines the observed state of NetworkQoS</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Status</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// A concise indication of whether the NetworkQoS resource is applied with success.</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="nx">Status</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;status,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// An array of condition objects indicating details about status of NetworkQoS object.</span>
<span class="w">    </span><span class="c1">// +optional</span>
<span class="w">    </span><span class="c1">// +patchMergeKey=type</span>
<span class="w">    </span><span class="c1">// +patchStrategy=merge</span>
<span class="w">    </span><span class="c1">// +listType=map</span>
<span class="w">    </span><span class="c1">// +listMapKey=type</span>
<span class="w">    </span><span class="nx">Conditions</span><span class="w"> </span><span class="p">[]</span><span class="nx">metav1</span><span class="p">.</span><span class="nx">Condition</span><span class="w"> </span><span class="s">`json:&quot;conditions,omitempty&quot; patchStrategy:&quot;merge&quot; patchMergeKey:&quot;type&quot;`</span>
<span class="p">}</span>

<span class="c1">// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object</span>
<span class="c1">// +kubebuilder:resource:path=networkqoses</span>
<span class="c1">// +kubebuilder::singular=networkqos</span>
<span class="c1">// NetworkQoSList contains a list of NetworkQoS</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">NetworkQoSList</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">metav1</span><span class="p">.</span><span class="nx">TypeMeta</span><span class="w"> </span><span class="s">`json:&quot;,inline&quot;`</span>
<span class="w">    </span><span class="nx">metav1</span><span class="p">.</span><span class="nx">ListMeta</span><span class="w"> </span><span class="s">`json:&quot;metadata,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Items</span><span class="w">           </span><span class="p">[]</span><span class="nx">NetworkQoS</span><span class="w"> </span><span class="s">`json:&quot;items&quot;`</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="implementation-details">Implementation Details<a class="headerlink" href="#implementation-details" title="Permanent link">&para;</a></h3>
<p>The new controller is introduced in OVN-Kubernetes which would watch <code>NetworkQoS</code>, <code>Pod</code> and <code>Node</code>
objects, which will create the relevant NetworkQoS objects and attach them to all the node local
switches in the cluster in OVN - resulting in the necessary flows to be programmed in OVS.</p>
<p>In order to not create an OVN NetworkQoS object per pod in the namespace, the controller will also
manage AddressSets. For each QoS rule specified in a given <code>NetworkQoS</code> it'll create an
AddressSet, adding only the pods whose label matches the PodSelector to it, making sure that<br />
new/updated/deleted matching pods are also added/updated/deleted accordingly. Rules that do not<br />
have a PodSelector will leverage the namespace's AddressSet.</p>
<p>Similarly, when <code>NetworkQoS</code> is created for Pods secondary network, OVN-K8s must create a new
AddressSet for every QoS rule. When no pod selector is specified, then it must contain all the<br />
pod's IP addresses that belong to the namespace and selected network. If only a set of pods are<br />
chosen via podSelector, then it must have IP addresses only for chosen pod(s).</p>
<p>For example, assuming there's a single node <code>node1</code> and the following <code>NetworkQoS</code> (maps to the Story-1 above)
is created:</p>
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkQoS</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.ovn.org/v1alpha1</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qos-external-paid</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">games</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">user-type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paid</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">      </span><span class="nt">classifier</span><span class="p">:</span>
<span class="w">        </span><span class="nt">to</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipBlock</span><span class="p">:</span>
<span class="w">            </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
<span class="w">            </span><span class="nt">except</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0/8</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.0.0/12</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.0/16</span>

<span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkQoS</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.ovn.org/v1alpha1</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qos-external-free</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">games</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">user-type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">free</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">11</span>
<span class="w">      </span><span class="nt">classifier</span><span class="p">:</span>
<span class="w">        </span><span class="nt">to</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipBlock</span><span class="p">:</span>
<span class="w">              </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
<span class="w">              </span><span class="nt">except</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0/8</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.0.0/12</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.0/16</span>
</code></pre></div>
<p>the equivalent of:</p>
<div class="highlight"><pre><span></span><code>ovn-nbctl<span class="w"> </span>qos-add<span class="w"> </span>node1<span class="w"> </span>to-lport<span class="w"> </span><span class="m">10020</span><span class="w"> </span><span class="s2">&quot;ip4.src == &lt;games-qos-external-paid address set&gt; &amp;&amp; ip4.dst != {10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16}&quot;</span><span class="w"> </span><span class="nv">dscp</span><span class="o">=</span><span class="m">20</span>
ovn-nbctl<span class="w"> </span>qos-add<span class="w"> </span>node1<span class="w"> </span>to-lport<span class="w"> </span><span class="m">10040</span><span class="w"> </span><span class="s2">&quot;ip4.src == &lt;games-qos-external-free address set&gt; &amp;&amp; ip4.dst != {10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16}&quot;</span><span class="w"> </span><span class="nv">dscp</span><span class="o">=</span><span class="m">11</span>
</code></pre></div>
<p>will be executed. The math for the priority is as described below:</p>
<ol>
<li>we want to save the first 10K OVN priorities for future use.</li>
<li>we evaluate the priority based on the fact that we allow only 20 rules per QoS object, and we use the index of the rule within the object
   So, 10020 was derived like so =&gt; 10000 + NetworkQoS.priority * 20 + index(rule) =&gt; 10000 + 1 * 20 + 0 =&gt; 10020
   S0, 10040 was derived like so =&gt; 10000 + 2 * 20 + 0</li>
</ol>
<p>Creating a new Pod in games namespace that matches the podSelector in either <code>qos-external-paid</code> or <code>qos-external-free</code>
results in its IPs being added to the corresponding Address Set.</p>
<p>Following example maps to the Story-2 above. It updates the above NetworkQoS objects to include the bandwidth fields. 
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkQoS</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.ovn.org/v1alpha1</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qos-external-free</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">games</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">user-type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">free</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">11</span>
<span class="w">      </span><span class="nt">bandwidth</span><span class="p">:</span>
<span class="w">        </span><span class="nt">burst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000000</span><span class="w"> </span><span class="c1"># in kbps</span>
<span class="w">        </span><span class="nt">rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000000</span><span class="w">  </span><span class="c1"># in kbps      </span>
<span class="w">      </span><span class="nt">classifier</span><span class="p">:</span>
<span class="w">        </span><span class="nt">to</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipBlock</span><span class="p">:</span>
<span class="w">              </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
<span class="w">              </span><span class="nt">except</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0/8</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.0.0/12</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.0/16</span>
</code></pre></div></p>
<p>In the above <code>qos-external-free</code> NetworkQoS example, all the pods in games namespace with <code>user-type: free</code> label
will have bandwidth limited to specified burst/rate towards the Internet. Such traffic will also have DSCP marking of
11. The equivalent of:</p>
<div class="highlight"><pre><span></span><code>ovn-nbctl<span class="w"> </span>qos-add<span class="w"> </span>node1<span class="w"> </span>to-lport<span class="w"> </span><span class="m">10040</span><span class="w"> </span><span class="s2">&quot;ip4.src == &lt;games-qos-external-free address set&gt; &amp;&amp; ip4.dst != {10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16}&quot;</span><span class="w"> </span><span class="nv">rate</span><span class="o">=</span><span class="m">20000</span><span class="w"> </span><span class="nv">burst</span><span class="o">=</span><span class="m">100</span><span class="w"> </span><span class="nv">dscp</span><span class="o">=</span><span class="m">11</span>
</code></pre></div>
<p>will be executed.</p>
<p>In addition, the controller will watch nodes to decide if further updates are needed, for example:
when another node <code>node2</code> joins the cluster, the controller will attach the existing <code>NetworkQoS</code>
object to its node local switch.</p>
<p>The <code>NetworkQoS</code> is supported on pod's secondary networks. That may also be a User Defined Network.
Consider the following example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkQoS</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.ovn.org/v1alpha1</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qos-external-free</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">games</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">networkSelectors</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">networkSelectionType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkAttachmentDefinitions</span>
<span class="w">      </span><span class="nt">networkAttachmentDefinitionSelector</span><span class="p">:</span>
<span class="w">        </span><span class="nt">namespaceSelector</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span><span class="w">   </span><span class="c1"># Empty selector will select all namespaces</span>
<span class="w">        </span><span class="nt">networkSelector</span><span class="p">:</span>
<span class="w">          </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ovn-storage</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">11</span>
<span class="w">      </span><span class="nt">classifier</span><span class="p">:</span>
<span class="w">        </span><span class="nt">to</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipBlock</span><span class="p">:</span>
<span class="w">              </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</code></pre></div>
<p>This creates a new AddressSet adding default namespace pod(s) IP associated with ovn-storage
secondary network, using NAD. The equivalent of:</p>
<div class="highlight"><pre><span></span><code>ovn-nbctl<span class="w"> </span>qos-add<span class="w"> </span>node1<span class="w"> </span>to-lport<span class="w"> </span><span class="m">10040</span><span class="w"> </span><span class="s2">&quot;ip4.src == &lt;games_ovn-storage_network address set&gt; &amp;&amp; ip4.dst == 0.0.0.0/0&quot;</span><span class="w"> </span><span class="nv">dscp</span><span class="o">=</span><span class="m">11</span>
</code></pre></div>
<p>will be executed.</p>
<p>IPv6 will also be supported, given the following <code>NetworkQoS</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.ovn.org/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkQoS</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">egress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">48</span>
<span class="w">      </span><span class="nt">classifier</span><span class="p">:</span>
<span class="w">        </span><span class="nt">to</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipBlock</span><span class="p">:</span>
<span class="w">              </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2001:0db8:85a3:0000:0000:8a2e:0370:7330/124</span>
</code></pre></div>
<p>and a single pod with the IP <code>fd00:10:244:2::3</code> in the namespace, the controller will create the
relevant NetworkQoS object that will result in a similar flow to this on the pod's node:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="nv">cookie</span><span class="o">=</span>0x6d99cb18,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">63</span>.310s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">18</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">63</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">555</span>,ipv6,metadata<span class="o">=</span>0x4,ipv6_src<span class="o">=</span>fd00:10:244:2::3,ipv6_dst<span class="o">=</span><span class="m">2001</span>:db8:85a3::8a2e:370:7330/124<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>mod_nw_tos:192,resubmit<span class="o">(</span>,19<span class="o">)</span>
</code></pre></div>
<h3 id="testing-details">Testing Details<a class="headerlink" href="#testing-details" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Unit tests coverage</p>
</li>
<li>
<p>Validate NetworkQoS <code>status</code> fields are populated correctly.</p>
</li>
<li>
<p>IPv4/IPv6 E2E that validates egress traffic from a namespace is marked with the correct DSCP value
  by creating and deleting <code>NetworkQoS</code>, setting up src pods and destination pods.</p>
</li>
<li>Traffic to the all targeted pod IPs should be marked.</li>
<li>Traffic to the targeted pod IPs, Protocol should be marked.</li>
<li>Traffic to the targeted pod IPs, Protocol and Port should be marked.</li>
<li>
<p>Traffic to an pod IP address not contained in the destination pod selector, Protocol and Port
    should not be marked.</p>
</li>
<li>
<p>IPv4/IPv6 E2E that validates egress traffic from a namespace is marked with the correct DSCP value
  by creating and deleting <code>NetworkQoS</code>, setting up src pods and host-networked destination pods.</p>
</li>
<li>Traffic to the specified CIDR should be marked.</li>
<li>Traffic to the specified CIDR, Protocol should be marked.</li>
<li>Traffic to the specified CIDR, Protocol and Port should be marked.</li>
<li>
<p>Traffic to an address not contained in the CIDR, Protocol and Port should not be marked.</p>
</li>
<li>
<p>IPv4/IPv6 E2E that validates egress traffic from a namespace is enforced with bandwidth limit by
  creating and deleting <code>NetworkQoS</code>, setting up src pods and destination pods.</p>
</li>
<li>Traffic to the all targeted pod IPs should be rate limited with specified bandwidth
    parameters.</li>
<li>Traffic to the targeted pod IPs, Protocol should be rate limited with specified bandwidth
    parameters.</li>
<li>Traffic to the targeted pod IPs, Protocol and Port should be rate limited with specified
    bandwidth parameters.</li>
<li>Traffic to an pod IP address not contained in the destination pod selector, Protocol and Port
    should not be rate limited with specified bandwidth parameters.</li>
</ul>
<h3 id="documentation-details">Documentation Details<a class="headerlink" href="#documentation-details" title="Permanent link">&para;</a></h3>
<p>To be discussed.</p>
<h2 id="risks-known-limitations-and-mitigations">Risks, Known Limitations and Mitigations<a class="headerlink" href="#risks-known-limitations-and-mitigations" title="Permanent link">&para;</a></h2>
<h2 id="ovn-kubernetes-version-skew">OVN-Kubernetes Version Skew<a class="headerlink" href="#ovn-kubernetes-version-skew" title="Permanent link">&para;</a></h2>
<p>To be discussed.</p>
<h2 id="alternatives">Alternatives<a class="headerlink" href="#alternatives" title="Permanent link">&para;</a></h2>
<p>N/A</p>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright  OVN-Kubernetes a Series of LF Projects, LLC. For website terms of use, trademark policy and other project policies please see <a href="https://lfprojects.org/policies/">LF Projects Policies</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.indexes", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "content.code.copy", "content.code.annotate", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../javascripts/gemini-api-key.js"></script>
      
        <script src="../../javascripts/theme.js"></script>
      
        <script src="../../javascripts/extra.js"></script>
      
    
  </body>
</html>